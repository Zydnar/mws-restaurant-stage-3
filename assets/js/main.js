!function i(o,s,u){function a(r,e){if(!s[r]){if(!o[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(c)return c(r,!0);throw new Error("Cannot find module '"+r+"'")}var n=s[r]={exports:{}};o[r][0].call(n.exports,function(e){var t=o[r][1][e];return a(t||e)},n,n.exports,i,o,s,u)}return s[r].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)a(u[e]);return a}({1:[function(e,r,n){(function(Mt){"use strict";var e,t,Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t=function(){var G=Object.keys,Q=Array.isArray,Z="undefined"!=typeof self?self:"undefined"!=typeof window?window:Mt;function ee(t,r){return"object"!==(void 0===r?"undefined":Rt(r))||G(r).forEach(function(e){t[e]=r[e]}),t}var i=Object.getPrototypeOf,r={}.hasOwnProperty;function te(e,t){return r.call(e,t)}function re(t,r){"function"==typeof r&&(r=r(i(t))),G(r).forEach(function(e){ne(t,e,r[e])})}var o=Object.defineProperty;function ne(e,t,r,n){o(e,t,ee(r&&te(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function s(t){return{from:function(e){return t.prototype=Object.create(e.prototype),ne(t.prototype,"constructor",t),{extend:re.bind(null,t.prototype)}}}}var u=Object.getOwnPropertyDescriptor;var n=[].slice;function ie(e,t,r){return n.call(e,t,r)}function oe(e,t){return t(e)}function se(e){if(!e)throw new Error("Assertion Failed")}function a(e){Z.setImmediate?setImmediate(e):setTimeout(e,0)}function ue(e,i){return e.reduce(function(e,t,r){var n=i(t,r);return n&&(e[n[0]]=n[1]),e},{})}function ae(e,t){return function(){try{e.apply(this,arguments)}catch(e){t(e)}}}function ce(e,t,r){try{e.apply(null,r)}catch(e){t&&t(e)}}function le(e,t){if(te(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var r=[],n=0,i=t.length;n<i;++n){var o=le(e,t[n]);r.push(o)}return r}var s=t.indexOf(".");if(-1!==s){var u=e[t.substr(0,s)];return void 0===u?void 0:le(u,t.substr(s+1))}}function fe(e,t,r){if(e&&void 0!==t&&!("isFrozen"in Object&&Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){se("string"!=typeof r&&"length"in r);for(var n=0,i=t.length;n<i;++n)fe(e,t[n],r[n])}else{var o=t.indexOf(".");if(-1!==o){var s=t.substr(0,o),u=t.substr(o+1);if(""===u)void 0===r?delete e[s]:e[s]=r;else{var a=e[s];a||(a=e[s]={}),fe(a,u,r)}}else void 0===r?delete e[t]:e[t]=r}}function he(e){var t={};for(var r in e)te(e,r)&&(t[r]=e[r]);return t}var t=[].concat;function pe(e){return t.apply([],e)}var c="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(pe([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(e){return Z[e]}).map(function(e){return Z[e]});function de(e){if(!e||"object"!==(void 0===e?"undefined":Rt(e)))return e;var t;if(Q(e)){t=[];for(var r=0,n=e.length;r<n;++r)t.push(de(e[r]))}else if(0<=c.indexOf(e.constructor))t=e;else for(var i in t=e.constructor?Object.create(e.constructor.prototype):{},e)te(e,i)&&(t[i]=de(e[i]));return t}function be(n,i,o,s){return o=o||{},s=s||"",G(n).forEach(function(e){if(te(i,e)){var t=n[e],r=i[e];"object"===(void 0===t?"undefined":Rt(t))&&"object"===(void 0===r?"undefined":Rt(r))&&t&&r&&""+t.constructor==""+r.constructor?be(t,r,o,s+e+"."):t!==r&&(o[s+e]=i[e])}else o[s+e]=void 0}),G(i).forEach(function(e){te(n,e)||(o[s+e]=i[e])}),o}var l="undefined"!=typeof Symbol&&Symbol.iterator,f=l?function(e){var t;return null!=e&&(t=e[l])&&t.apply(e)}:function(){return null},ve={};function ye(e){var t,r,n,i;if(1===arguments.length){if(Q(e))return e.slice();if(this===ve&&"string"==typeof e)return[e];if(i=f(e)){for(r=[];!(n=i.next()).done;)r.push(n.value);return r}if(null==e)return[e];if("number"==typeof(t=e.length)){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}var me="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function h(e,t){me=e,p=t}var p=function(){return!0},e=!new Error("").stack;function ge(){if(e)try{throw new Error}catch(e){return e}return new Error}function we(e,t){var r=e.stack;return r?(t=t||0,0===r.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),r.split("\n").slice(t).filter(p).map(function(e){return"\n"+e}).join("")):""}var d=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],b=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(d),v={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function y(e,t){this._e=ge(),this.name=e,this.message=t}function _e(e,t,r,n){this._e=ge(),this.failures=t,this.failedKeys=n,this.successCount=r}function Oe(e,t){this._e=ge(),this.name="BulkError",this.failures=t,this.message=e+". Errors: "+t.map(function(e){return e.toString()}).filter(function(e,t,r){return r.indexOf(e)===t}).join("\n")}s(y).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+we(this._e,2))}},toString:function(){return this.name+": "+this.message}}),s(_e).from(y),s(Oe).from(y);var m=b.reduce(function(e,t){return e[t]=t+"Error",e},{}),g=y,xe=b.reduce(function(e,r){var n=r+"Error";function t(e,t){this._e=ge(),this.name=n,e?"string"==typeof e?(this.message=e,this.inner=t||null):"object"===(void 0===e?"undefined":Rt(e))&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=v[r]||n,this.inner=null)}return s(t).from(g),e[r]=t,e},{});xe.Syntax=SyntaxError,xe.Type=TypeError,xe.Range=RangeError;var w=d.reduce(function(e,t){return e[t+"Error"]=xe[t],e},{});var _=b.reduce(function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=xe[t]),e},{});function Se(){}function Ee(e){return e}function ke(t,r){return null==t||t===Ee?r:function(e){return r(t(e))}}function O(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function je(i,o){return i===Se?o:function(){var e=i.apply(this,arguments);void 0!==e&&(arguments[0]=e);var t=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var n=o.apply(this,arguments);return t&&(this.onsuccess=this.onsuccess?O(t,this.onsuccess):t),r&&(this.onerror=this.onerror?O(r,this.onerror):r),void 0!==n?n:e}}function Ae(r,n){return r===Se?n:function(){r.apply(this,arguments);var e=this.onsuccess,t=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),e&&(this.onsuccess=this.onsuccess?O(e,this.onsuccess):e),t&&(this.onerror=this.onerror?O(t,this.onerror):t)}}function Te(o,s){return o===Se?s:function(e){var t=o.apply(this,arguments);ee(e,t);var r=this.onsuccess,n=this.onerror;this.onsuccess=null,this.onerror=null;var i=s.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?O(r,this.onsuccess):r),n&&(this.onerror=this.onerror?O(n,this.onerror):n),void 0===t?void 0===i?void 0:i:ee(t,i)}}function x(e,t){return e===Se?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function Pe(i,o){return i===Se?o:function(){var e=i.apply(this,arguments);if(e&&"function"==typeof e.then){for(var t=this,r=arguments.length,n=new Array(r);r--;)n[r]=arguments[r];return e.then(function(){return o.apply(t,n)})}return o.apply(this,arguments)}}_.ModifyError=_e,_.DexieError=y,_.BulkError=Oe;var S={},E=100,k=7,j=function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}catch(e){var t=Z.Promise;return t?[t.resolve(),t.prototype,t.resolve()]:[]}}(),A=j[0],T=j[1],P=j[2],I=T&&T.then,Ie=A&&A.constructor,Me=j[3],M=!!P,R=!1,D=P?function(){P.then(Ce)}:Z.setImmediate?setImmediate.bind(null,Ce):Z.MutationObserver?function(){var e=document.createElement("div");new MutationObserver(function(){Ce(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(Ce,0)},B=function(e,t){U.push([e,t]),C&&(D(),C=!1)},N=!0,C=!0,L=[],F=[],H=null,q=Ee,K={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:st,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(e){try{st(e[0],e[1])}catch(e){}})}},Re=K,U=[],W=0,V=[];function De(e){if("object"!==Rt(this))throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Se,this._lib=!1;var t=this._PSD=Re;if(me&&(this._stackHolder=ge(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==S)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Y(this,this._value))}this._state=null,this._value=null,++t.ref,function t(n,e){try{e(function(r){if(null===n._state){if(r===n)throw new TypeError("A promise cannot be resolved with itself.");var e=n._lib&&Le();r&&"function"==typeof r.then?t(n,function(e,t){r instanceof De?r._then(e,t):r.then(e,t)}):(n._state=!0,n._value=r,$(n)),e&&Fe()}},Y.bind(null,n))}catch(e){Y(n,e)}}(this,e)}var z={get:function(){var s=Re,t=Xe;function e(r,n){var i=this,o=!s.global&&(s!==Re||t!==Xe);o&&Ge();var e=new De(function(e,t){J(i,new X(nt(r,s,o),nt(n,s,o),e,t,s))});return me&&Ne(e,this),e}return e.prototype=S,e},set:function(e){ne(this,"then",e&&e.prototype===S?z:{get:function(){return e},set:z.set})}};function X(e,t,r,n,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n,this.psd=i}function Y(t,r){if(F.push(r),null===t._state){var n,e=t._lib&&Le();r=q(r),t._state=!1,t._value=r,me&&null!==r&&"object"===(void 0===r?"undefined":Rt(r))&&!r._promise&&ce(function(){var e=function e(t,r){var n;return u(t,r)||(n=i(t))&&e(n,r)}(r,"stack");r._promise=t,ne(r,"stack",{get:function(){return R?e&&(e.get?e.get.apply(r):e.value):t.stack}})}),n=t,L.some(function(e){return e._value===n._value})||L.push(n),$(t),e&&Fe()}}function $(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)J(e,t[r]);var i=e._PSD;--i.ref||i.finalize(),0===W&&(++W,B(function(){0==--W&&He()},[]))}function J(e,t){if(null!==e._state){var r=e._state?t.onFulfilled:t.onRejected;if(null===r)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++W,B(Be,[r,e,t])}else e._listeners.push(t)}function Be(e,t,r){try{var n,i=(H=t)._value;t._state?n=e(i):(F.length&&(F=[]),n=e(i),-1===F.indexOf(i)&&function(e){var t=L.length;for(;t;)if(L[--t]._value===e._value)return L.splice(t,1)}(t)),r.resolve(n)}catch(e){r.reject(e)}finally{H=null,0==--W&&He(),--r.psd.ref||r.psd.finalize()}}function Ne(e,t){var r=t?t._numPrev+1:0;r<E&&(e._prev=t,e._numPrev=r)}function Ce(){Le()&&Fe()}function Le(){var e=N;return C=N=!1,e}function Fe(){var e,t,r;do{for(;0<U.length;)for(e=U,U=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}}while(0<U.length);C=N=!0}function He(){var e=L;L=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var t=V.slice(0),r=t.length;r;)t[--r]()}function qe(e){return new De(S,!1,e)}function Ke(r,n){var i=Re;return function(){var e=Le(),t=Re;try{return et(i,!0),r.apply(this,arguments)}catch(e){n&&n(e)}finally{et(t,!1),e&&Fe()}}}re(De.prototype,{then:z,_then:function(e,t){J(this,new X(null,null,e,t,Re))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=e,r=arguments[1];return"function"==typeof t?this.then(null,function(e){return e instanceof t?r(e):qe(e)}):this.then(null,function(e){return e&&e.name===t?r(e):qe(e)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),qe(e)})},stack:{get:function(){if(this._stack)return this._stack;try{R=!0;var e=function e(t,r,n){if(r.length===n)return r;var i="";if(!1===t._state){var o,s,u=t._value;null!=u?(o=u.name||"Error",s=u.message||u,i=we(u,0)):(o=u,s=""),r.push(o+(s?": "+s:"")+i)}me&&((i=we(t._stackHolder,2))&&-1===r.indexOf(i)&&r.push(i),t._prev&&e(t._prev,r,n));return r}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{R=!1}}},timeout:function(n,i){var o=this;return n<1/0?new De(function(e,t){var r=setTimeout(function(){return t(new xe.Timeout(i))},n);o.then(e,t).finally(clearTimeout.bind(null,r))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&ne(De.prototype,Symbol.toStringTag,"Promise"),K.env=tt(),re(De,{all:function(){var o=ye.apply(null,arguments).map(Qe);return new De(function(r,n){0===o.length&&r([]);var i=o.length;o.forEach(function(e,t){return De.resolve(e).then(function(e){o[t]=e,--i||r(o)},n)})})},resolve:function(r){if(r instanceof De)return r;if(r&&"function"==typeof r.then)return new De(function(e,t){r.then(e,t)});var e=new De(S,!0,r);return Ne(e,H),e},reject:qe,race:function(){var e=ye.apply(null,arguments).map(Qe);return new De(function(t,r){e.map(function(e){return De.resolve(e).then(t,r)})})},PSD:{get:function(){return Re},set:function(e){return Re=e}},newPSD:$e,usePSD:rt,scheduler:{get:function(){return B},set:function(e){B=e}},rejectionMapper:{get:function(){return q},set:function(e){q=e}},follow:function(i,r){return new De(function(e,t){return $e(function(r,n){var e=Re;e.unhandleds=[],e.onunhandled=n,e.finalize=O(function(){var t,e=this;t=function(){0===e.unhandleds.length?r():n(e.unhandleds[0])},V.push(function e(){t(),V.splice(V.indexOf(e),1)}),++W,B(function(){0==--W&&He()},[])},e.finalize),i()},r,e,t)})}});var Ue={awaits:0,echoes:0,id:0},We=0,Ve=[],ze=0,Xe=0,Ye=0;function $e(e,t,r,n){var i=Re,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++Ye;var s=K.env;o.env=M?{Promise:De,PromiseProp:{value:De,configurable:!0,writable:!0},all:De.all,race:De.race,resolve:De.resolve,reject:De.reject,nthen:it(s.nthen,o),gthen:it(s.gthen,o)}:{},t&&ee(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=rt(o,e,r,n);return 0===o.ref&&o.finalize(),u}function Je(){return Ue.id||(Ue.id=++We),++Ue.awaits,Ue.echoes+=k,Ue.id}function Ge(e){!Ue.awaits||e&&e!==Ue.id||(0==--Ue.awaits&&(Ue.id=0),Ue.echoes=Ue.awaits*k)}function Qe(e){return Ue.echoes&&e&&e.constructor===Ie?(Je(),e.then(function(e){return Ge(),e},function(e){return Ge(),ut(e)})):e}function Ze(){var e=Ve[Ve.length-1];Ve.pop(),et(e,!1)}function et(e,t){var r,n=Re;if((t?!Ue.echoes||ze++&&e===Re:!ze||--ze&&e===Re)||(r=t?function(e){++Xe,Ue.echoes&&0!=--Ue.echoes||(Ue.echoes=Ue.id=0),Ve.push(Re),et(e,!0)}.bind(null,e):Ze,I.call(A,r)),e!==Re&&(Re=e,n===K&&(K.env=tt()),M)){var i=K.env.Promise,o=e.env;T.then=o.nthen,i.prototype.then=o.gthen,(n.global||e.global)&&(Object.defineProperty(Z,"Promise",o.PromiseProp),i.all=o.all,i.race=o.race,i.resolve=o.resolve,i.reject=o.reject)}}function tt(){var e=Z.Promise;return M?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(Z,"Promise"),all:e.all,race:e.race,resolve:e.resolve,reject:e.reject,nthen:T.then,gthen:e.prototype.then}:{}}function rt(e,t,r,n,i){var o=Re;try{return et(e,!0),t(r,n,i)}finally{et(o,!1)}}function nt(t,r,n){return"function"!=typeof t?t:function(){var e=Re;n&&Je(),et(r,!0);try{return t.apply(this,arguments)}finally{et(e,!1)}}}function it(r,n){return function(e,t){return r.call(this,nt(e,n,!1),nt(t,n,!1))}}var ot="unhandledrejection";function st(e,t){var r;try{r=t.onuncatched(e)}catch(e){}if(!1!==r)try{var n,i={promise:t,reason:e};if(Z.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(ot,!0,!0),ee(n,i)):Z.CustomEvent&&ee(n=new CustomEvent(ot,{detail:i}),i),n&&Z.dispatchEvent&&(dispatchEvent(n),!Z.PromiseRejectionEvent&&Z.onunhandledrejection))try{Z.onunhandledrejection(n)}catch(e){}n.defaultPrevented||console.warn("Unhandled rejection: "+(e.stack||e))}catch(e){}}var ut=De.reject;function at(i){var s={},t=function(e,t){if(t){for(var r=arguments.length,n=new Array(r-1);--r;)n[r-1]=arguments[r];return s[e].subscribe.apply(null,n),i}if("string"==typeof e)return s[e]};t.addEventType=u;for(var e=1,r=arguments.length;e<r;++e)u(arguments[e]);return t;function u(e,r,n){if("object"!==(void 0===e?"undefined":Rt(e))){var i;r||(r=x),n||(n=Se);var o={subscribers:[],fire:n,subscribe:function(e){-1===o.subscribers.indexOf(e)&&(o.subscribers.push(e),o.fire=r(o.fire,e))},unsubscribe:function(t){o.subscribers=o.subscribers.filter(function(e){return e!==t}),o.fire=o.subscribers.reduce(r,n)}};return s[e]=t[e]=o,o}G(i=e).forEach(function(e){var t=i[e];if(Q(t))u(e,i[e][0],i[e][1]);else{if("asap"!==t)throw new xe.InvalidArgument("Invalid event config");var r=u(e,Ee,function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach(function(e){a(function(){e.apply(null,t)})})})}})}}var ct,lt=String.fromCharCode(65535),ft=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(e){return lt}}(),ht=-1/0,pt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",dt="String expected.",bt=[],vt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),yt=vt,mt=vt,gt=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)};function wt(o,e){var t,r,f,n,i,s=wt.dependencies,u=ee({addons:wt.addons,autoOpen:!0,indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange},e),a=u.addons,c=u.autoOpen,l=u.indexedDB,g=u.IDBKeyRange,h=this._dbSchema={},p=[],d=[],b={},v=null,y=null,m=!1,w=null,_=!1,O="readonly",x="readwrite",S=this,E=new De(function(e){t=e}),k=new De(function(e,t){r=t}),j=!0,A=!!It(l);function T(e){this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function P(e,t,r){var n=S._createTransaction(x,d,h);n.create(t),n._completion.catch(r);var i=n._reject.bind(n);$e(function(){Re.trans=n,0===e?(G(h).forEach(function(e){I(t,e,h[e].primKey,h[e].indexes)}),De.follow(function(){return S.on.populate.fire(n)}).catch(i)):function(t,i,o){var r=[],e=p.filter(function(e){return e._cfg.version===t})[0];if(!e)throw new xe.Upgrade("Dexie specification of currently installed DB version is missing");h=S._dbSchema=e._cfg.dbschema;var s=!1;return p.filter(function(e){return e._cfg.version>t}).forEach(function(n){r.push(function(){var e=h,t=n._cfg.dbschema;$(e,o),$(t,o),h=S._dbSchema=t;var r=function(e,t){var r={del:[],add:[],change:[]};for(var n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],o=t[n];if(i){var s={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(i.primKey.src!==o.primKey.src)s.recreate=!0,r.change.push(s);else{var u=i.idxByName,a=o.idxByName;for(var c in u)a[c]||s.del.push(c);for(c in a){var l=u[c],f=a[c];l?l.src!==f.src&&s.change.push(f):s.add.push(f)}(0<s.del.length||0<s.add.length||0<s.change.length)&&r.change.push(s)}}else r.add.push([n,o])}return r}(e,t);if(r.add.forEach(function(e){I(o,e[0],e[1].primKey,e[1].indexes)}),r.change.forEach(function(e){if(e.recreate)throw new xe.Upgrade("Not yet support for changing primary key");var t=o.objectStore(e.name);e.add.forEach(function(e){M(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),M(t,e)}),e.del.forEach(function(e){t.deleteIndex(e)})}),n._cfg.contentUpgrade)return s=!0,De.follow(function(){n._cfg.contentUpgrade(i)})}),r.push(function(e){s&&yt||function(e,t){for(var r=0;r<t.db.objectStoreNames.length;++r){var n=t.db.objectStoreNames[r];null==e[n]&&t.db.deleteObjectStore(n)}}(n._cfg.dbschema,e)})}),function e(){return r.length?De.resolve(r.shift()(i.idbtrans)).then(e):De.resolve()}().then(function(){var t,r;r=o,G(t=h).forEach(function(e){r.db.objectStoreNames.contains(e)||I(r,e,t[e].primKey,t[e].indexes)})})}(e,n,t).catch(i)})}function I(e,t,r,n){var i=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(function(e){M(i,e)}),i}function M(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function R(e,t,r){this.name=e,this.schema=t,this._tx=r,this.hook=b[e]?b[e].hook:at(null,{creating:[je,Se],reading:[ke,Ee],updating:[Te,Se],deleting:[Ae,Se]})}function D(t,r,e){return(e?Et:xt)(function(e){t.push(e),r&&r()})}function B(c,l,f,h,p){return new De(function(n,e){var i=f.length,o=i-1;if(0===i)return n();if(h){var s,u=Et(e),a=Ot(null);ce(function(){for(var e=0;e<i;++e){s={onsuccess:null,onerror:null};var t=f[e];p.call(s,t[0],t[1],l);var r=c.delete(t[0]);r._hookCtx=s,r.onerror=u,r.onsuccess=e===o?Ot(n):a}},function(e){throw s.onerror&&s.onerror(e),e})}else for(var t=0;t<i;++t){var r=c.delete(f[t]);r.onerror=xt(e),t===o&&(r.onsuccess=Ke(function(){return n()}))}})}function N(e,t,r,n){var i=this;this.db=S,this.mode=e,this.storeNames=t,this.idbtrans=null,this.on=at(this,"complete","error","abort"),this.parent=n||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new De(function(e,t){i._resolve=e,i._reject=t}),this._completion.then(function(){i.active=!1,i.on.complete.fire()},function(e){var t=i.active;return i.active=!1,i.on.error.fire(e),i.parent?i.parent._reject(e):t&&i.idbtrans&&i.idbtrans.abort(),ut(e)})}function C(e,t,r){this._ctx={table:e,index:":id"===t?null:t,or:r}}function L(e,t){var r=null,n=null;if(t)try{r=t()}catch(e){n=e}var i=e._ctx,o=i.table;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:n,or:i.or,valueMapper:o.hook.reading.fire}}function F(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function H(e,t){return e._cfg.version-t._cfg.version}function q(e,t,n){t.forEach(function(t){var r=n[t];e.forEach(function(e){t in e||(e===N.prototype||e instanceof N?ne(e,t,{get:function(){return this.table(t)}}):e[t]=new R(t,r))})})}function K(r,n,i,o,s,u){var a=Ke(u?function(e,t,r){return i(u(e),t,r)}:i,s);r.onerror||(r.onerror=xt(s)),r.onsuccess=ae(n?function(){var e=r.result;if(e){var t=function(){e.continue()};n(e,function(e){t=e},o,s)&&a(e.value,e,function(e){t=e}),t()}else o()}:function(){var e=r.result;if(e){var t=function(){e.continue()};a(e.value,e,function(e){t=e}),t()}else o()},s)}function U(e,t){return l.cmp(e,t)}function W(e,t){return l.cmp(e,t)}function V(e,t){return l.cmp(t,e)}function z(e,t){return e<t?-1:e===t?0:1}function X(e,t){return t<e?-1:e===t?0:1}function Y(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}function $(e,t){for(var r=t.db.objectStoreNames,n=0;n<r.length;++n){var i=r[n],o=t.objectStore(i);f="getAll"in o;for(var s=0;s<o.indexNames.length;++s){var u=o.indexNames[s],a=o.index(u).keyPath,c="string"==typeof a?a:"["+ie(a).join("+")+"]";if(e[i]){var l=e[i].idxByName[c];l&&(l.name=u)}}}/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Z.WorkerGlobalScope&&Z instanceof Z.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(f=!1)}function J(t){S.on("blocked").fire(t),bt.filter(function(e){return e.name===S.name&&e!==S&&!e._vcFired}).map(function(e){return e.on("versionchange").fire(t)})}this.version=function(t){if(v||m)throw new xe.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=p.filter(function(e){return e._cfg.version===t})[0];return e||(e=new T(t),p.push(e),p.sort(H),j=!1,e)},ee(T.prototype,{stores:function(e){this._cfg.storesSource=this._cfg.storesSource?ee(this._cfg.storesSource,e):e;var t={};p.forEach(function(e){ee(t,e._cfg.storesSource)});var r=this._cfg.dbschema={};return this._parseStoresSpec(t,r),h=S._dbSchema=r,[b,S,N.prototype].forEach(function(e){for(var t in e)e[t]instanceof R&&delete e[t]}),q([b,S,N.prototype,this._cfg.tables],G(r),r),d=G(r),this},upgrade:function(e){return this._cfg.contentUpgrade=e,this},_parseStoresSpec:function(s,u){G(s).forEach(function(e){if(null!==s[e]){var t={},r=(i=s[e],o=[],i.split(",").forEach(function(e){var t=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(t)?t.match(/^\[(.*)\]$/)[1].split("+"):t;o.push(new At(t,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Q(r),/\./.test(e)))}),o),n=r.shift();if(n.multi)throw new xe.Schema("Primary key cannot be multi-valued");n.keyPath&&fe(t,n.keyPath,n.auto?0:n.keyPath),r.forEach(function(e){if(e.auto)throw new xe.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new xe.Schema("Index must have a name and cannot be an empty string");fe(t,e.keyPath,e.compound?e.keyPath.map(function(){return""}):"")}),u[e]=new Tt(e,n,r,t)}var i,o})}}),this._allTables=b,this._createTransaction=function(e,t,r,n){return new N(e,t,r,n)},this._whenReady=function(e){return _||Re.letThrough?e():new De(function(e,t){if(!m){if(!c)return void t(new xe.DatabaseClosed);S.open().catch(Se)}E.then(e,t)}).then(e)},this.verno=0,this.open=function(){if(m||v)return E.then(function(){return y?ut(y):S});me&&(k._stackHolder=ge()),_=!(m=!0);var e=t,i=y=null;return De.race([k,new De(function(e,r){if(!l)throw new xe.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var n=j?l.open(o):l.open(o,Math.round(10*S.verno));if(!n)throw new xe.MissingAPI("IndexedDB API not available");n.onerror=xt(r),n.onblocked=Ke(J),n.onupgradeneeded=Ke(function(e){if(i=n.transaction,j&&!S._allowEmptyDB){n.onerror=kt,i.abort(),n.result.close();var t=l.deleteDatabase(o);t.onsuccess=t.onerror=Ke(function(){r(new xe.NoSuchDatabase("Database "+o+" doesnt exist"))})}else{i.onerror=xt(r),P((e.oldVersion>Math.pow(2,62)?0:e.oldVersion)/10,i,r)}},r),n.onsuccess=Ke(function(){if(i=null,v=n.result,bt.push(S),j)!function(){if(S.verno=v.version/10,S._dbSchema=h={},0===(d=ie(v.objectStoreNames,0)).length)return;var c=v.transaction(Pt(d),"readonly");d.forEach(function(e){for(var t=c.objectStore(e),r=t.keyPath,n=r&&"string"==typeof r&&-1!==r.indexOf("."),i=new At(r,r||"",!1,!1,!!t.autoIncrement,r&&"string"!=typeof r,n),o=[],s=0;s<t.indexNames.length;++s){var u=t.index(t.indexNames[s]);r=u.keyPath,n=r&&"string"==typeof r&&-1!==r.indexOf(".");var a=new At(u.name,r,!!u.unique,!!u.multiEntry,!1,r&&"string"!=typeof r,n);o.push(a)}h[e]=new Tt(e,i,o,{})}),q([b],G(h),h)}();else if(0<v.objectStoreNames.length)try{$(h,v.transaction(Pt(v.objectStoreNames),O))}catch(e){}v.onversionchange=Ke(function(e){S._vcFired=!0,S.on("versionchange").fire(e)}),A||"__dbnames"===o||ct.dbnames.put({name:o}).catch(Se),e()},r)})]).then(function(){return w=[],De.resolve(wt.vip(S.on.ready.fire)).then(function e(){if(0<w.length){var t=w.reduce(Pe,Se);return w=[],De.resolve(wt.vip(t)).then(e)}})}).finally(function(){w=null}).then(function(){return m=!1,S}).catch(function(e){try{i&&i.abort()}catch(e){}return m=!1,S.close(),ut(y=e)}).finally(function(){_=!0,e()})},this.close=function(){var e=bt.indexOf(S);if(0<=e&&bt.splice(e,1),v){try{v.close()}catch(e){}v=null}c=!1,y=new xe.DatabaseClosed,m&&r(y),E=new De(function(e){t=e}),k=new De(function(e,t){r=t})},this.delete=function(){var n=0<arguments.length;return new De(function(t,r){if(n)throw new xe.InvalidArgument("Arguments not allowed in db.delete()");function e(){S.close();var e=l.deleteDatabase(o);e.onsuccess=Ke(function(){A||ct.dbnames.delete(o).catch(Se),t()}),e.onerror=xt(r),e.onblocked=J}m?E.then(e):e()})},this.backendDB=function(){return v},this.isOpen=function(){return null!==v},this.hasBeenClosed=function(){return y&&y instanceof xe.DatabaseClosed},this.hasFailed=function(){return null!==y},this.dynamicallyOpened=function(){return j},this.name=o,re(this,{tables:{get:function(){return G(b).map(function(e){return b[e]})}}}),this.on=at(this,"populate","blocked","versionchange",{ready:[Pe,Se]}),this.on.ready.subscribe=oe(this.on.ready.subscribe,function(r){return function(t,e){wt.vip(function(){_?(y||De.resolve().then(t),e&&r(t)):w?(w.push(t),e&&r(t)):(r(t),e||r(function e(){S.on.ready.unsubscribe(t),S.on.ready.unsubscribe(e)}))})}}),this.transaction=function(){var e=function(e,t,r){var n=arguments.length;if(n<2)throw new xe.InvalidArgument("Too few arguments");var i=new Array(n-1);for(;--n;)i[n-1]=arguments[n];r=i.pop();var o=pe(i);return[e,o,r]}.apply(this,arguments);return this._transaction.apply(this,e)},this._transaction=function(o,e,s){var u=Re.trans;u&&u.db===S&&-1===o.indexOf("!")||(u=null);var t=-1!==o.indexOf("?");o=o.replace("!","").replace("?","");try{var a=e.map(function(e){var t=e instanceof R?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t});if("r"==o||o==O)o=O;else{if("rw"!=o&&o!=x)throw new xe.InvalidArgument("Invalid transaction mode: "+o);o=x}if(u){if(u.mode===O&&o===x){if(!t)throw new xe.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");u=null}u&&a.forEach(function(e){if(u&&-1===u.storeNames.indexOf(e)){if(!t)throw new xe.SubTransaction("Table "+e+" not included in parent transaction.");u=null}}),t&&u&&!u.active&&(u=null)}}catch(r){return u?u._promise(null,function(e,t){t(r)}):ut(r)}return u?u._promise(o,r,"lock"):Re.trans?rt(Re.transless,function(){return S._whenReady(r)}):S._whenReady(r);function r(){return De.resolve().then(function(){var t,e=Re.transless||Re,r=S._createTransaction(o,a,h,u),n={trans:r,transless:e};u?r.idbtrans=u.idbtrans:r.create(),s.constructor===Me&&Je();var i=De.follow(function(){if(t=s.call(r,r))if(t.constructor===Ie){var e=Ge.bind(null,null);t.then(e,e)}else"function"==typeof t.next&&"function"==typeof t.throw&&(t=jt(t))},n);return(t&&"function"==typeof t.then?De.resolve(t).then(function(e){return r.active?e:ut(new xe.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):i.then(function(){return t})).then(function(e){return u&&r._resolve(),r._completion.then(function(){return e})}).catch(function(e){return r._reject(e),ut(e)})})}},this.table=function(e){if(!te(b,e))throw new xe.InvalidTable("Table "+e+" does not exist");return b[e]},re(R.prototype,{_trans:function(e,t,r){var n=this._tx||Re.trans;return n&&n.db===S?n===Re.trans?n._promise(e,t,r):$e(function(){return n._promise(e,t,r)},{trans:n,transless:Re.transless||Re}):function e(t,r,n){if(_||Re.letThrough){var i=S._createTransaction(t,r,h);try{i.create()}catch(e){return ut(e)}return i._promise(t,function(e,t){return $e(function(){return Re.trans=i,n(e,t,i)})}).then(function(e){return i._completion.then(function(){return e})})}if(!m){if(!c)return ut(new xe.DatabaseClosed);S.open().catch(Se)}return E.then(function(){return e(t,r,n)})}(e,[this.name],t)},_idbstore:function(e,n,t){var i=this.name;return this._trans(e,function(e,t,r){if(-1===r.storeNames.indexOf(i))throw new xe.NotFound("Table"+i+" not part of transaction");return n(e,t,r.idbtrans.objectStore(i),r)},t)},get:function(i,e){if(i&&i.constructor===Object)return this.where(i).first(e);var o=this;return this._idbstore(O,function(e,t,r){var n=r.get(i);n.onerror=xt(t),n.onsuccess=Ke(function(){e(o.hook.reading.fire(n.result))},t)}).then(e)},where:function(r){if("string"==typeof r)return new C(this,r);if(Q(r))return new C(this,"["+r.join("+")+"]");var n=G(r);if(1===n.length)return this.where(n[0]).equals(r[n[0]]);var e=this.schema.indexes.concat(this.schema.primKey).filter(function(t){return t.compound&&n.every(function(e){return 0<=t.keyPath.indexOf(e)})&&t.keyPath.every(function(e){return 0<=n.indexOf(e)})})[0];if(e&&ft!==lt)return this.where(e.name).equals(e.keyPath.map(function(e){return r[e]}));e||console.warn("The query "+JSON.stringify(r)+" on "+this.name+" would benefit of a compound index ["+n.join("+")+"]");var i=this.schema.idxByName,t=n.reduce(function(e,t){return[e[0]||i[t],e[0]||!i[t]?Y(e[1],function(e){return""+le(e,t)==""+r[t]}):e[1]]},[null,null]),o=t[0];return o?this.where(o.name).equals(r[o.keyPath]).filter(t[1]):e?this.filter(t[1]):this.where(n).equals("")},count:function(e){return this.toCollection().count(e)},offset:function(e){return this.toCollection().offset(e)},limit:function(e){return this.toCollection().limit(e)},reverse:function(){return this.toCollection().reverse()},filter:function(e){return this.toCollection().and(e)},each:function(e){return this.toCollection().each(e)},toArray:function(e){return this.toCollection().toArray(e)},orderBy:function(e){return new L(new C(this,Q(e)?"["+e.join("+")+"]":e))},toCollection:function(){return new L(new C(this))},mapToClass:function(n,e){this.schema.mappedClass=n;var t=Object.create(n.prototype);e&&_t(t,e),this.schema.instanceTemplate=t;var r=function(e){if(!e)return e;var t=Object.create(n.prototype);for(var r in e)if(te(e,r))try{t[r]=e[r]}catch(e){}return t};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),n},defineClass:function(e){return this.mapToClass(wt.defineClass(e),e)},bulkDelete:function(i){return this.hook.deleting.fire===Se?this._idbstore(x,function(e,t,r,n){e(B(r,n,i,!1,Se))}):this.where(":id").anyOf(i).delete().then(function(){})},bulkPut:function(p,d){var b=this;return this._idbstore(x,function(t,r,n){if(!n.keyPath&&!b.schema.primKey.auto&&!d)throw new xe.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(n.keyPath&&d)throw new xe.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(d&&d.length!==p.length)throw new xe.InvalidArgument("Arguments objects and keys must have the same length");if(0===p.length)return t();var e,i,o=function(e){0===s.length?t(e):r(new Oe(b.name+".bulkPut(): "+s.length+" of "+u+" operations failed",s))},s=[],u=p.length,a=b;if(b.hook.creating.fire===Se&&b.hook.updating.fire===Se){i=D(s);for(var c=0,l=p.length;c<l;++c)(e=d?n.put(p[c],d[c]):n.put(p[c])).onerror=i;e.onerror=D(s,o),e.onsuccess=St(o)}else{var f=d||n.keyPath&&p.map(function(e){return le(e,n.keyPath)}),h=f&&ue(f,function(e,t){return null!=e&&[e,p[t]]});(f?a.where(":id").anyOf(f.filter(function(e){return null!=e})).modify(function(){this.value=h[this.primKey],h[this.primKey]=null}).catch(_e,function(e){s=e.failures}).then(function(){for(var e=[],t=d&&[],r=f.length-1;0<=r;--r){var n=f[r];(null==n||h[n])&&(e.push(p[r]),d&&t.push(n),null!=n&&(h[n]=null))}return e.reverse(),d&&t.reverse(),a.bulkAdd(e,t)}).then(function(e){var t=f[f.length-1];return null!=t?t:e}):a.bulkAdd(p)).then(o).catch(Oe,function(e){s=s.concat(e.failures),o()}).catch(r)}},"locked")},bulkAdd:function(d,b){var v=this,y=this.hook.creating.fire;return this._idbstore(x,function(t,r,s,u){if(!s.keyPath&&!v.schema.primKey.auto&&!b)throw new xe.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(s.keyPath&&b)throw new xe.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(b&&b.length!==d.length)throw new xe.InvalidArgument("Arguments objects and keys must have the same length");if(0===d.length)return t();function e(e){0===n.length?t(e):r(new Oe(v.name+".bulkAdd(): "+n.length+" of "+i+" operations failed",n))}var a,c,l,n=[],i=d.length;if(y!==Se){var f,h=s.keyPath;c=D(n,null,!0),l=Ot(null),ce(function(){for(var e=0,t=d.length;e<t;++e){f={onerror:null,onsuccess:null};var r=b&&b[e],n=d[e],i=b?r:h?le(n,h):void 0,o=y.call(f,i,n,u);null==i&&null!=o&&(h?fe(n=de(n),h,o):r=o),(a=null!=r?s.add(n,r):s.add(n))._hookCtx=f,e<t-1&&(a.onerror=c,f.onsuccess&&(a.onsuccess=l))}},function(e){throw f.onerror&&f.onerror(e),e}),a.onerror=D(n,e,!0),a.onsuccess=Ot(e)}else{c=D(n);for(var o=0,p=d.length;o<p;++o)(a=b?s.add(d[o],b[o]):s.add(d[o])).onerror=c;a.onerror=D(n,e),a.onsuccess=St(e)}})},add:function(a,c){var l=this.hook.creating.fire;return this._idbstore(x,function(r,e,n,t){var i={onsuccess:null,onerror:null};if(l!==Se){var o=null!=c?c:n.keyPath?le(a,n.keyPath):void 0,s=l.call(i,o,a,t);null==o&&null!=s&&(n.keyPath?fe(a,n.keyPath,s):c=s)}try{var u=null!=c?n.add(a,c):n.add(a);u._hookCtx=i,u.onerror=Et(e),u.onsuccess=Ot(function(e){var t=n.keyPath;t&&fe(a,t,e),r(e)})}catch(e){throw i.onerror&&i.onerror(e),e}})},put:function(o,t){var r=this,e=this.hook.creating.fire,n=this.hook.updating.fire;if(e!==Se||n!==Se){var i=this.schema.primKey.keyPath,s=void 0!==t?t:i&&le(o,i);return null==s?this.add(o):(o=de(o),this._trans(x,function(){return r.where(":id").equals(s).modify(function(){this.value=o}).then(function(e){return 0===e?r.add(o,t):s})},"locked"))}return this._idbstore(x,function(r,e,n){var i=void 0!==t?n.put(o,t):n.put(o);i.onerror=xt(e),i.onsuccess=Ke(function(e){var t=n.keyPath;t&&fe(o,t,e.target.result),r(i.result)})})},delete:function(i){return this.hook.deleting.subscribers.length?this.where(":id").equals(i).delete():this._idbstore(x,function(e,t,r){var n=r.delete(i);n.onerror=xt(t),n.onsuccess=Ke(function(){e(n.result)})})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(x,function(e,t,r){var n=r.clear();n.onerror=xt(t),n.onsuccess=Ke(function(){e(n.result)})})},update:function(t,r){if("object"!==(void 0===r?"undefined":Rt(r))||Q(r))throw new xe.InvalidArgument("Modifications must be an object.");if("object"!==(void 0===t?"undefined":Rt(t))||Q(t))return this.where(":id").equals(t).modify(r);G(r).forEach(function(e){fe(t,e,r[e])});var e=le(t,this.schema.primKey.keyPath);return void 0===e?ut(new xe.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(r)}}),re(N.prototype,{_lock:function(){return se(!Re.global),++this._reculock,1!==this._reculock||Re.global||(Re.lockOwnerFor=this),this},_unlock:function(){if(se(!Re.global),0==--this._reculock)for(Re.global||(Re.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{rt(e[1],e[0])}catch(e){}}return this},_locked:function(){return this._reculock&&Re.lockOwnerFor!==this},create:function(t){var r=this;if(!this.mode)return this;if(se(!this.idbtrans),!t&&!v)switch(y&&y.name){case"DatabaseClosedError":throw new xe.DatabaseClosed(y);case"MissingAPIError":throw new xe.MissingAPI(y.message,y);default:throw new xe.OpenFailed(y)}if(!this.active)throw new xe.TransactionInactive;return se(null===this._completion._state),(t=this.idbtrans=t||v.transaction(Pt(this.storeNames),this.mode)).onerror=Ke(function(e){kt(e),r._reject(t.error)}),t.onabort=Ke(function(e){kt(e),r.active&&r._reject(new xe.Abort(t.error)),r.active=!1,r.on("abort").fire(e)}),t.oncomplete=Ke(function(){r.active=!1,r._resolve()}),this},_promise:function(r,n,i){var o=this;if(r===x&&this.mode!==x)return ut(new xe.ReadOnly("Transaction is readonly"));if(!this.active)return ut(new xe.TransactionInactive);if(this._locked())return new De(function(e,t){o._blockedFuncs.push([function(){o._promise(r,n,i).then(e,t)},Re])});if(i)return $e(function(){var e=new De(function(e,t){o._lock();var r=n(e,t,o);r&&r.then&&r.then(e,t)});return e.finally(function(){return o._unlock()}),e._lib=!0,e});var e=new De(function(e,t){var r=n(e,t,o);r&&r.then&&r.then(e,t)});return e._lib=!0,e},_root:function(){return this.parent?this.parent._root():this},waitFor:function(e){var n=this._root();if(e=De.resolve(e),n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return e});else{n._waitingFor=e,n._waitingQueue=[];var t=n.idbtrans.objectStore(n.storeNames[0]);!function e(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=e)}()}var i=n._waitingFor;return new De(function(t,r){e.then(function(e){return n._waitingQueue.push(Ke(t.bind(null,e)))},function(e){return n._waitingQueue.push(Ke(r.bind(null,e)))}).finally(function(){n._waitingFor===i&&(n._waitingFor=null)})})},abort:function(){this.active&&this._reject(new xe.Abort),this.active=!1},tables:{get:(n="Transaction.tables",i=function(){return b},function(){return console.warn(n+" is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+we(ge(),1)),i.apply(this,arguments)})},table:function(e){var t=S.table(e);return new R(e,t.schema,this)}}),re(C.prototype,function(){function y(e,t,r){var n=e instanceof C?new L(e):e;return n._ctx.error=r?new r(t):new TypeError(t),n}function h(e){return new L(e,function(){return g.only("")}).limit(0)}function m(e,t,r,n,i,o){for(var s=Math.min(e.length,n.length),u=-1,a=0;a<s;++a){var c=t[a];if(c!==n[a])return i(e[a],r[a])<0?e.substr(0,a)+r[a]+r.substr(a+1):i(e[a],n[a])<0?e.substr(0,a)+n[a]+r.substr(a+1):0<=u?e.substr(0,u)+t[u]+r.substr(u+1):null;i(e[a],c)<0&&(u=a)}return s<n.length&&"next"===o?e+r.substr(e.length):s<e.length&&"prev"===o?e.substr(0,r.length):u<0?null:e.substr(0,u)+n[u]+r.substr(u+1)}function t(e,a,r,n){var i,c,l,f,h,p,d,b=r.length;if(!r.every(function(e){return"string"==typeof e}))return y(e,dt);function t(e){i="next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()},c="next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()},l="next"===e?z:X;var t=r.map(function(e){return{lower:c(e),upper:i(e)}}).sort(function(e,t){return l(e.lower,t.lower)});f=t.map(function(e){return e.upper}),h=t.map(function(e){return e.lower}),d="next"===(p=e)?"":n}t("next");var o=new L(e,function(){return g.bound(f[0],h[b-1]+n)});o._ondirectionchange=function(e){t(e)};var v=0;return o._addAlgorithm(function(e,t,r){var n=e.key;if("string"!=typeof n)return!1;var i=c(n);if(a(i,h,v))return!0;for(var o=null,s=v;s<b;++s){var u=m(n,i,f[s],h[s],l,p);null===u&&null===o?v=s+1:(null===o||0<l(o,u))&&(o=u)}return t(null!==o?function(){e.continue(o+d)}:r),!1}),o}return{between:function(e,t,r,n){r=!1!==r,n=!0===n;try{return 0<U(e,t)||0===U(e,t)&&(r||n)&&(!r||!n)?h(this):new L(this,function(){return g.bound(e,t,!r,!n)})}catch(e){return y(this,pt)}},equals:function(e){return new L(this,function(){return g.only(e)})},above:function(e){return new L(this,function(){return g.lowerBound(e,!0)})},aboveOrEqual:function(e){return new L(this,function(){return g.lowerBound(e)})},below:function(e){return new L(this,function(){return g.upperBound(e,!0)})},belowOrEqual:function(e){return new L(this,function(){return g.upperBound(e)})},startsWith:function(e){return"string"!=typeof e?y(this,dt):this.between(e,e+lt,!0,!0)},startsWithIgnoreCase:function(e){return""===e?this.startsWith(e):t(this,function(e,t){return 0===e.indexOf(t[0])},[e],lt)},equalsIgnoreCase:function(e){return t(this,function(e,t){return e===t[0]},[e],"")},anyOfIgnoreCase:function(){var e=ye.apply(ve,arguments);return 0===e.length?h(this):t(this,function(e,t){return-1!==t.indexOf(e)},e,"")},startsWithAnyOfIgnoreCase:function(){var e=ye.apply(ve,arguments);return 0===e.length?h(this):t(this,function(t,e){return e.some(function(e){return 0===t.indexOf(e)})},e,lt)},anyOf:function(){var i=ye.apply(ve,arguments),o=W;try{i.sort(o)}catch(e){return y(this,pt)}if(0===i.length)return h(this);var e=new L(this,function(){return g.bound(i[0],i[i.length-1])});e._ondirectionchange=function(e){o="next"===e?W:V,i.sort(o)};var s=0;return e._addAlgorithm(function(e,t,r){for(var n=e.key;0<o(n,i[s]);)if(++s===i.length)return t(r),!1;return 0===o(n,i[s])||(t(function(){e.continue(i[s])}),!1)}),e},notEqual:function(e){return this.inAnyRange([[ht,e],[e,ft]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var e=ye.apply(ve,arguments);if(0===e.length)return new L(this);try{e.sort(W)}catch(e){return y(this,pt)}var t=e.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[ht,t]]},null);return t.push([e[e.length-1],ft]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(e,t){if(0===e.length)return h(this);if(!e.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&W(e[0],e[1])<=0}))return y(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",xe.InvalidArgument);var r=!t||!1!==t.includeLowers,n=t&&!0===t.includeUppers;var o,s=W;function i(e,t){return s(e[0],t[0])}try{(o=e.reduce(function(e,t){for(var r=0,n=e.length;r<n;++r){var i=e[r];if(U(t[0],i[1])<0&&0<U(t[1],i[0])){i[0]=(u=i[0],a=t[0],U(u,a)<0?u:a),i[1]=(o=i[1],s=t[1],0<U(o,s)?o:s);break}}var o,s,u,a;return r===n&&e.push(t),e},[])).sort(i)}catch(e){return y(this,pt)}var u=0,a=n?function(e){return 0<W(e,o[u][1])}:function(e){return 0<=W(e,o[u][1])},c=r?function(e){return 0<V(e,o[u][0])}:function(e){return 0<=V(e,o[u][0])};var l=a,f=new L(this,function(){return g.bound(o[0][0],o[o.length-1][1],!r,!n)});return f._ondirectionchange=function(e){"next"===e?(l=a,s=W):(l=c,s=V),o.sort(i)},f._addAlgorithm(function(e,t,r){for(var n,i=e.key;l(i);)if(++u===o.length)return t(r),!1;return!a(n=i)&&!c(n)||(0===U(i,o[u][1])||0===U(i,o[u][0])||t(function(){s===W?e.continue(o[u][0]):e.continue(o[u][1])}),!1)}),f},startsWithAnyOf:function(){var e=ye.apply(ve,arguments);return e.every(function(e){return"string"==typeof e})?0===e.length?h(this):this.inAnyRange(e.map(function(e){return[e,e+lt]})):y(this,"startsWithAnyOf() only works with strings")}}}),re(L.prototype,function(){function o(e,t){e.filter=Y(e.filter,t)}function r(e,t,r){var n=e.replayFilter;e.replayFilter=n?function(){return Y(n(),t())}:t,e.justLimit=r&&!n}function a(e,t){if(e.isPrimKey)return t;var r=e.table.schema.idxByName[e.index];if(!r)throw new xe.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return t.index(r.name)}function l(e,t){var r=a(e,t);return e.keysOnly&&"openKeyCursor"in r?r.openKeyCursor(e.range||null,e.dir+e.unique):r.openCursor(e.range||null,e.dir+e.unique)}function c(r,u,n,a,i){var c=r.replayFilter?Y(r.filter,r.replayFilter()):r.filter;r.or?function(){var o={},e=0;function s(){2==++e&&n()}function t(e,t,r){if(!c||c(t,r,s,a)){var n=t.primaryKey,i=""+n;"[object ArrayBuffer]"===i&&(i=""+new Uint8Array(n)),te(o,i)||(o[i]=!0,u(e,t,r))}}r.or._iterate(t,s,a,i),K(l(r,i),r.algorithm,t,s,a,!r.keysOnly&&r.valueMapper)}():K(l(r,i),Y(r.algorithm,c),u,n,a,!r.keysOnly&&r.valueMapper)}return{_read:function(e,t){var r=this._ctx;return r.error?r.table._trans(null,ut.bind(null,r.error)):r.table._idbstore(O,e).then(t)},_write:function(e){var t=this._ctx;return t.error?t.table._trans(null,ut.bind(null,t.error)):t.table._idbstore(x,e,"locked")},_addAlgorithm:function(e){var t=this._ctx;t.algorithm=Y(t.algorithm,e)},_iterate:function(e,t,r,n){return c(this._ctx,e,t,r,n)},clone:function(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&ee(r,e),t._ctx=r,t},raw:function(){return this._ctx.valueMapper=null,this},each:function(n){var i=this._ctx;return this._read(function(e,t,r){c(i,n,e,t,r)})},count:function(e){var o=this._ctx;if(F(o,!0))return this._read(function(t,e,r){var n=a(o,r),i=o.range?n.count(o.range):n.count();i.onerror=xt(e),i.onsuccess=function(e){t(Math.min(e.target.result,o.limit))}},e);var n=0;return this._read(function(e,t,r){c(o,function(){return++n,!1},function(){e(n)},t,r)},e)},sortBy:function(e,t){var r=e.split(".").reverse(),n=r[0],i=r.length-1;function o(e,t){return t?o(e[r[t]],t-1):e[n]}var s="next"===this._ctx.dir?1:-1;function u(e,t){var r=o(e,i),n=o(t,i);return r<n?-s:n<r?s:0}return this.toArray(function(e){return e.sort(u)}).then(t)},toArray:function(e){var u=this._ctx;return this._read(function(t,r,e){if(f&&"next"===u.dir&&F(u,!0)&&0<u.limit){var n=u.table.hook.reading.fire,i=a(u,e),o=u.limit<1/0?i.getAll(u.range,u.limit):i.getAll(u.range);o.onerror=xt(r),o.onsuccess=St(n===Ee?t:function(e){try{t(e.map(n))}catch(e){r(e)}})}else{var s=[];c(u,function(e){s.push(e)},function(){t(s)},r,e)}},e)},offset:function(t){var e=this._ctx;return t<=0||(e.offset+=t,F(e)?r(e,function(){var r=t;return function(e,t){return 0===r||(1===r?--r:t(function(){e.advance(r),r=0}),!1)}}):r(e,function(){var e=t;return function(){return--e<0}})),this},limit:function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),r(this._ctx,function(){var n=e;return function(e,t,r){return--n<=0&&t(r),0<=n}},!0),this},until:function(n,i){return o(this._ctx,function(e,t,r){return!n(e.value)||(t(r),i)}),this},first:function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},last:function(e){return this.reverse().first(e)},filter:function(t){var e,r;return o(this._ctx,function(e){return t(e.value)}),e=this._ctx,r=t,e.isMatch=Y(e.isMatch,r),this},and:function(e){return this.filter(e)},or:function(e){return new C(this._ctx.table,e,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(r){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,t){r(t.key,t)})},eachUniqueKey:function(e){return this._ctx.unique="unique",this.eachKey(e)},eachPrimaryKey:function(r){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,t){r(t.primaryKey,t)})},keys:function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(e,t){r.push(t.key)}).then(function(){return r}).then(e)},primaryKeys:function(e){var o=this._ctx;if(f&&"next"===o.dir&&F(o,!0)&&0<o.limit)return this._read(function(e,t,r){var n=a(o,r),i=o.limit<1/0?n.getAllKeys(o.range,o.limit):n.getAllKeys(o.range);i.onerror=xt(t),i.onsuccess=St(e)}).then(e);o.keysOnly=!o.isMatch;var r=[];return this.each(function(e,t){r.push(t.primaryKey)}).then(function(){return r}).then(e)},uniqueKeys:function(e){return this._ctx.unique="unique",this.keys(e)},firstKey:function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},lastKey:function(e){return this.reverse().firstKey(e)},distinct:function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return o(this._ctx,function(e){var t=e.primaryKey.toString(),r=te(n,t);return n[t]=!0,!r}),this},modify:function(v){var y=this,e=this._ctx.table.hook,m=e.updating.fire,g=e.deleting.fire;return this._write(function(e,t,r,i){var o;if("function"==typeof v)o=m===Se&&g===Se?v:function(t){var e=de(t);if(!1===v.call(this,t,this))return!1;if(te(this,"value")){var r=be(e,this.value),n=m.call(this,r,this.primKey,e,i);n&&(t=this.value,G(n).forEach(function(e){fe(t,e,n[e])}))}else g.call(this,this.primKey,t,i)};else if(m===Se){var s=G(v),u=s.length;o=function(e){for(var t=!1,r=0;r<u;++r){var n=s[r],i=v[n];le(e,n)!==i&&(fe(e,n,i),t=!0)}return t}}else{var a=v;v=he(a),o=function(r){var n=!1,e=m.call(this,v,this.primKey,de(r),i);return e&&ee(v,e),G(v).forEach(function(e){var t=v[e];le(r,e)!==t&&(fe(r,e,t),n=!0)}),e&&(v=he(a)),n}}var c=0,l=0,n=!1,f=[],h=[],p=null;function d(e){return e&&(f.push(e),h.push(p)),t(new _e("Error modifying one or more objects",f,l,h))}function b(){n&&l+f.length===c&&(0<f.length?d():e(l))}y.clone().raw()._iterate(function(e,t){p=t.primaryKey;var r={primKey:t.primaryKey,value:e,onsuccess:null,onerror:null};function n(e){return f.push(e),h.push(r.primKey),b(),!0}if(!1!==o.call(r,e,r)){var i=!te(r,"value");++c,ce(function(){var e=i?t.delete():t.update(r.value);e._hookCtx=r,e.onerror=Et(n),e.onsuccess=Ot(function(){++l,b()})},n)}else r.onsuccess&&r.onsuccess(r.value)},function(){n=!0,b()},d,r)})},delete:function(){var u=this,a=this._ctx,s=a.range,c=a.table.hook.deleting.fire,l=c!==Se;if(!l&&F(a)&&(a.isPrimKey&&!mt||!s))return this._write(function(r,n,i){var o=xt(n),e=s?i.count(s):i.count();e.onerror=o,e.onsuccess=function(){var t=e.result;ce(function(){var e=s?i.delete(s):i.clear();e.onerror=o,e.onsuccess=function(){return r(t)}},function(e){return n(e)})}});var f=l?2e3:1e4;return this._write(function(e,t,r,n){var i=0,o=u.clone({keysOnly:!a.isMatch&&!l}).distinct().limit(f).raw(),s=[];e(function t(){return o.each(l?function(e,t){s.push([t.primaryKey,t.value])}:function(e,t){s.push(t.primaryKey)}).then(function(){return l?s.sort(function(e,t){return W(e[0],t[0])}):s.sort(W),B(r,n,s,l,c)}).then(function(){var e=s.length;return i+=e,s=[],e<f?i:t()})}())})}}}),ee(this,{Collection:L,Table:R,Transaction:N,Version:T,WhereClause:C}),S.on("versionchange",function(e){0<e.newVersion?console.warn("Another connection wants to upgrade database '"+S.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+S.name+"'. Closing db now to resume the delete request."),S.close()}),S.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+S.name+"') was blocked"):console.warn("Upgrade '"+S.name+"' blocked by other connection holding version "+e.oldVersion/10)}),a.forEach(function(e){e(S)})}function _t(r,n){return G(n).forEach(function(e){var t=function e(t){if("function"==typeof t)return new t;if(Q(t))return[e(t[0])];if(t&&"object"===(void 0===t?"undefined":Rt(t))){var r={};return _t(r,t),r}return t}(n[e]);r[e]=t}),r}function Ot(o){return Ke(function(e){var t=e.target,r=t._hookCtx,n=r.value||t.result,i=r&&r.onsuccess;i&&i(n),o&&o(n)},o)}function xt(t){return Ke(function(e){return kt(e),t(e.target.error),!1})}function St(t){return Ke(function(e){t(e.target.result)})}function Et(o){return Ke(function(e){var t=e.target,r=t.error,n=t._hookCtx,i=n&&n.onerror;return i&&i(r),kt(e),o(r),!1})}function kt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}function jt(t){var e=function(e){return t.next(e)},i=r(e),o=r(function(e){return t.throw(e)});function r(n){return function(e){var t=n(e),r=t.value;return t.done?r:r&&"function"==typeof r.then?r.then(i,o):Q(r)?De.all(r).then(i,o):i(r)}}return r(e)()}function At(e,t,r,n,i,o,s){this.name=e,this.keyPath=t,this.unique=r,this.multi=n,this.auto=i,this.compound=o,this.dotted=s;var u="string"==typeof t?t:t&&"["+[].join.call(t,"+")+"]";this.src=(r?"&":"")+(n?"*":"")+(i?"++":"")+u}function Tt(e,t,r,n){this.name=e,this.primKey=t||new At,this.indexes=r||[new At],this.instanceTemplate=n,this.mappedClass=null,this.idxByName=ue(r,function(e){return[e.name,e]})}function Pt(e){return 1===e.length?e[0]:e}function It(e){var t=e&&(e.getDatabaseNames||e.webkitGetDatabaseNames);return t&&t.bind(e)}return h(me,gt),re(wt,_),re(wt,{delete:function(e){var t=new wt(e),r=t.delete();return r.onblocked=function(e){return t.on("blocked",e),this},r},exists:function(e){return new wt(e).open().then(function(e){return e.close(),!0}).catch(wt.NoSuchDatabaseError,function(){return!1})},getDatabaseNames:function(e){var n=It(wt.dependencies.indexedDB);return n?new De(function(t,e){var r=n();r.onsuccess=function(e){t(ie(e.target.result,0))},r.onerror=xt(e)}).then(e):ct.dbnames.toCollection().primaryKeys(e)},defineClass:function(){return function(e){e&&ee(this,e)}},applyStructure:_t,ignoreTransaction:function(e){return Re.trans?rt(Re.transless,e):e()},vip:function(e){return $e(function(){return Re.letThrough=!0,e()})},async:function(t){return function(){try{var e=jt(t.apply(this,arguments));return e&&"function"==typeof e.then?e:De.resolve(e)}catch(e){return ut(e)}}},spawn:function(e,t,r){try{var n=jt(e.apply(r,t||[]));return n&&"function"==typeof n.then?n:De.resolve(n)}catch(e){return ut(e)}},currentTransaction:{get:function(){return Re.trans||null}},waitFor:function(e,t){var r=De.resolve("function"==typeof e?wt.ignoreTransaction(e):e).timeout(t||6e4);return Re.trans?Re.trans.waitFor(r):r},Promise:De,debug:{get:function(){return me},set:function(e){h(e,"dexie"===e?function(){return!0}:gt)}},derive:s,extend:ee,props:re,override:oe,Events:at,getByKeyPath:le,setByKeyPath:fe,delByKeyPath:function(t,e){"string"==typeof e?fe(t,e,void 0):"length"in e&&[].map.call(e,function(e){fe(t,e,void 0)})},shallowClone:he,deepClone:de,getObjectDiff:be,asap:a,maxKey:ft,minKey:ht,addons:[],connections:bt,MultiModifyError:xe.Modify,errnames:m,IndexSpec:At,TableSchema:Tt,dependencies:function(){try{return{indexedDB:Z.indexedDB||Z.mozIndexedDB||Z.webkitIndexedDB||Z.msIndexedDB,IDBKeyRange:Z.IDBKeyRange||Z.webkitIDBKeyRange}}catch(e){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:"2.0.4",version:"2.0.4".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,r){return e+t/Math.pow(10,2*r)}),default:wt,Dexie:wt}),De.rejectionMapper=function(e,t){if(!e||e instanceof y||e instanceof TypeError||e instanceof SyntaxError||!e.name||!w[e.name])return e;var r=new w[e.name](t||e.message,e);return"stack"in e&&ne(r,"stack",{get:function(){return this.inner.stack}}),r},(ct=new wt("__dbnames")).version(1).stores({dbnames:"name"}),function(){var e="Dexie.DatabaseNames";try{void 0!==("undefined"==typeof localStorage?"undefined":Rt(localStorage))&&void 0!==Z.document&&(JSON.parse(localStorage.getItem(e)||"[]").forEach(function(e){return ct.dbnames.put({name:e}).catch(Se)}),localStorage.removeItem(e))}catch(e){}}(),wt},"object"===((e=void 0)===n?"undefined":Rt(n))&&void 0!==r?r.exports=t():"function"==typeof define&&define.amd?define(t):e.Dexie=t()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){"use strict";var i=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},n=function(n){function e(e,t,r){n.call(this),this.parent=e,this.outerValue=t,this.outerIndex=r,this.index=0}return i(e,n),e.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},e.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(e("./Subscriber").Subscriber);r.InnerSubscriber=n},{"./Subscriber":9}],3:[function(e,t,r){"use strict";var n=e("./Observable"),i=function(){function t(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue="N"===e}return t.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},t.prototype.do=function(e,t,r){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return r&&r()}},t.prototype.accept=function(e,t,r){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,r)},t.prototype.toObservable=function(){switch(this.kind){case"N":return n.Observable.of(this.value);case"E":return n.Observable.throw(this.error);case"C":return n.Observable.empty()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}();r.Notification=i},{"./Observable":4}],4:[function(e,t,r){"use strict";var o=e("./util/root"),s=e("./util/toSubscriber"),n=e("./symbol/observable"),i=e("./util/pipe"),u=function(){function r(e){this._isScalar=!1,e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,r){var n=this.operator,i=s.toSubscriber(e,t,r);if(n?n.call(i,this.source):i.add(this.source||!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.syncErrorThrown=!0,t.syncErrorValue=e,t.error(e)}},r.prototype.forEach=function(n,e){var i=this;if(e||(o.root.Rx&&o.root.Rx.config&&o.root.Rx.config.Promise?e=o.root.Rx.config.Promise:o.root.Promise&&(e=o.root.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,t){var r;r=i.subscribe(function(e){if(r)try{n(e)}catch(e){t(e),r.unsubscribe()}else n(e)},t,e)})},r.prototype._subscribe=function(e){return this.source.subscribe(e)},r.prototype[n.observable]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 0===e.length?this:i.pipeFromArray(e)(this)},r.prototype.toPromise=function(e){var n=this;if(e||(o.root.Rx&&o.root.Rx.config&&o.root.Rx.config.Promise?e=o.root.Rx.config.Promise:o.root.Promise&&(e=o.root.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,t){var r;n.subscribe(function(e){return r=e},function(e){return t(e)},function(){return e(r)})})},r.create=function(e){return new r(e)},r}();r.Observable=u},{"./symbol/observable":49,"./util/pipe":62,"./util/root":63,"./util/toSubscriber":65}],5:[function(e,t,r){"use strict";r.empty={closed:!0,next:function(e){},error:function(e){throw e},complete:function(){}}},{}],6:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(e("./Subscriber").Subscriber);r.OuterSubscriber=i},{"./Subscriber":9}],7:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./Observable"),o=e("./Subscriber"),s=e("./Subscription"),u=e("./util/ObjectUnsubscribedError"),a=e("./SubjectSubscription"),c=e("./symbol/rxSubscriber"),l=function(t){function e(e){t.call(this,e),this.destination=e}return n(e,t),e}(o.Subscriber);r.SubjectSubscriber=l;var f=function(t){function e(){t.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return n(e,t),e.prototype[c.rxSubscriber]=function(){return new l(this)},e.prototype.lift=function(e){var t=new h(this,this);return t.operator=e,t},e.prototype.next=function(e){if(this.closed)throw new u.ObjectUnsubscribedError;if(!this.isStopped)for(var t=this.observers,r=t.length,n=t.slice(),i=0;i<r;i++)n[i].next(e)},e.prototype.error=function(e){if(this.closed)throw new u.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,r=t.length,n=t.slice(),i=0;i<r;i++)n[i].error(e);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new u.ObjectUnsubscribedError;this.isStopped=!0;for(var e=this.observers,t=e.length,r=e.slice(),n=0;n<t;n++)r[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new u.ObjectUnsubscribedError;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(e){if(this.closed)throw new u.ObjectUnsubscribedError;return this.hasError?(e.error(this.thrownError),s.Subscription.EMPTY):this.isStopped?(e.complete(),s.Subscription.EMPTY):(this.observers.push(e),new a.SubjectSubscription(this,e))},e.prototype.asObservable=function(){var e=new i.Observable;return e.source=this,e},e.create=function(e,t){return new h(e,t)},e}(i.Observable),h=function(r){function e(e,t){r.call(this),this.destination=e,this.source=t}return n(e,r),e.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},e.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},e.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},e.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):s.Subscription.EMPTY},e}(r.Subject=f);r.AnonymousSubject=h},{"./Observable":4,"./SubjectSubscription":8,"./Subscriber":9,"./Subscription":10,"./symbol/rxSubscriber":50,"./util/ObjectUnsubscribedError":51}],8:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=function(r){function e(e,t){r.call(this),this.subject=e,this.subscriber=t,this.closed=!1}return n(e,r),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}},e}(e("./Subscription").Subscription);r.SubjectSubscription=i},{"./Subscription":10}],9:[function(e,t,r){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},u=e("./util/isFunction"),i=e("./Subscription"),a=e("./Observer"),c=e("./symbol/rxSubscriber"),l=function(o){function i(e,t,r){switch(o.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=a.empty;break;case 1:if(!e){this.destination=a.empty;break}if("object"===(void 0===e?"undefined":s(e))){if((i=e)instanceof l||"syncErrorThrowable"in i&&i[c.rxSubscriber]){var n=e[c.rxSubscriber]();this.syncErrorThrowable=n.syncErrorThrowable,(this.destination=n).add(this)}else this.syncErrorThrowable=!0,this.destination=new f(this,e);break}default:this.syncErrorThrowable=!0,this.destination=new f(this,e,t,r)}var i}return n(i,o),i.prototype[c.rxSubscriber]=function(){return this},i.create=function(e,t,r){var n=new i(e,t,r);return n.syncErrorThrowable=!1,n},i.prototype.next=function(e){this.isStopped||this._next(e)},i.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},i.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},i.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,o.prototype.unsubscribe.call(this))},i.prototype._next=function(e){this.destination.next(e)},i.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},i.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},i.prototype._unsubscribeAndRecycle=function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this},i}(i.Subscription),f=function(s){function e(e,t,r,n){var i;s.call(this),this._parentSubscriber=e;var o=this;u.isFunction(t)?i=t:t&&(i=t.next,r=t.error,n=t.complete,t!==a.empty&&(o=Object.create(t),u.isFunction(o.unsubscribe)&&this.add(o.unsubscribe.bind(o)),o.unsubscribe=this.unsubscribe.bind(this))),this._context=o,this._next=i,this._error=r,this._complete=n}return n(e,s),e.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},e.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?this.__tryOrSetError(t,this._error,e):this.__tryOrUnsub(this._error,e),this.unsubscribe();else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}},e.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};t.syncErrorThrowable?this.__tryOrSetError(t,r):this.__tryOrUnsub(r),this.unsubscribe()}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){throw this.unsubscribe(),e}},e.prototype.__tryOrSetError=function(t,e,r){try{e.call(this._context,r)}catch(e){return t.syncErrorValue=e,t.syncErrorThrown=!0}return!1},e.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},e}(r.Subscriber=l)},{"./Observer":5,"./Subscription":10,"./symbol/rxSubscriber":50,"./util/isFunction":57}],10:[function(e,t,r){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=e("./util/isArray"),f=e("./util/isObject"),h=e("./util/isFunction"),p=e("./util/tryCatch"),d=e("./util/errorObject"),b=e("./util/UnsubscriptionError"),n=function(){function n(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var e;return n.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var r=this._parent,n=this._parents,i=this._unsubscribe,o=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var s=-1,u=n?n.length:0;r;)r.remove(this),r=++s<u&&n[s]||null;if(h.isFunction(i))p.tryCatch(i).call(this)===d.errorObject&&(t=!0,e=e||(d.errorObject.e instanceof b.UnsubscriptionError?v(d.errorObject.e.errors):[d.errorObject.e]));if(l.isArray(o))for(s=-1,u=o.length;++s<u;){var a=o[s];if(f.isObject(a))if(p.tryCatch(a.unsubscribe).call(a)===d.errorObject){t=!0,e=e||[];var c=d.errorObject.e;c instanceof b.UnsubscriptionError?e=e.concat(v(c.errors)):e.push(c)}}if(t)throw new b.UnsubscriptionError(e)}},n.prototype.add=function(e){if(!e||e===n.EMPTY)return n.EMPTY;if(e===this)return this;var t=e;switch(void 0===e?"undefined":i(e)){case"function":t=new n(e);case"object":if(t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if("function"!=typeof t._addParent){var r=t;(t=new n)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(t),t._addParent(this),t},n.prototype.remove=function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}},n.prototype._addParent=function(e){var t=this._parent,r=this._parents;t&&t!==e?r?-1===r.indexOf(e)&&r.push(e):this._parents=[e]:this._parent=e},n.EMPTY=((e=new n).closed=!0,e),n}();function v(e){return e.reduce(function(e,t){return e.concat(t instanceof b.UnsubscriptionError?t.errors:t)},[])}r.Subscription=n},{"./util/UnsubscriptionError":53,"./util/errorObject":54,"./util/isArray":55,"./util/isFunction":57,"./util/isObject":58,"./util/tryCatch":66}],11:[function(e,t,r){"use strict";var n=e("../../Observable"),i=e("../../observable/from");n.Observable.from=i.from},{"../../Observable":4,"../../observable/from":30}],12:[function(e,t,r){"use strict";var n=e("../../Observable"),i=e("../../observable/fromEvent");n.Observable.fromEvent=i.fromEvent},{"../../Observable":4,"../../observable/fromEvent":31}],13:[function(e,t,r){"use strict";var n=e("../../Observable"),i=e("../../observable/fromPromise");n.Observable.fromPromise=i.fromPromise},{"../../Observable":4,"../../observable/fromPromise":32}],14:[function(e,t,r){"use strict";var n=e("../../Observable"),i=e("../../operator/catch");n.Observable.prototype.catch=i._catch,n.Observable.prototype._catch=i._catch},{"../../Observable":4,"../../operator/catch":33}],15:[function(e,t,r){"use strict";var n=e("../../Observable"),i=e("../../operator/distinct");n.Observable.prototype.distinct=i.distinct},{"../../Observable":4,"../../operator/distinct":34}],16:[function(e,t,r){"use strict";var n=e("../../Observable"),i=e("../../operator/filter");n.Observable.prototype.filter=i.filter},{"../../Observable":4,"../../operator/filter":35}],17:[function(e,t,r){"use strict";var n=e("../../Observable"),i=e("../../operator/map");n.Observable.prototype.map=i.map},{"../../Observable":4,"../../operator/map":36}],18:[function(e,t,r){"use strict";var n=e("../../Observable"),i=e("../../operator/mergeMap");n.Observable.prototype.mergeMap=i.mergeMap,n.Observable.prototype.flatMap=i.mergeMap},{"../../Observable":4,"../../operator/mergeMap":37}],19:[function(e,t,r){"use strict";var n=e("../../Observable"),i=e("../../operator/retry");n.Observable.prototype.retry=i.retry},{"../../Observable":4,"../../operator/retry":38}],20:[function(e,t,r){"use strict";var n=e("../../Observable"),i=e("../../operator/retryWhen");n.Observable.prototype.retryWhen=i.retryWhen},{"../../Observable":4,"../../operator/retryWhen":39}],21:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../Observable"),s=e("./ScalarObservable"),u=e("./EmptyObservable"),o=function(r){function o(e,t){r.call(this),this.arrayLike=e,(this.scheduler=t)||1!==e.length||(this._isScalar=!0,this.value=e[0])}return n(o,r),o.create=function(e,t){var r=e.length;return 0===r?new u.EmptyObservable:1===r?new s.ScalarObservable(e[0],t):new o(e,t)},o.dispatch=function(e){var t=e.arrayLike,r=e.index,n=e.length,i=e.subscriber;i.closed||(n<=r?i.complete():(i.next(t[r]),e.index=r+1,this.schedule(e)))},o.prototype._subscribe=function(e){var t=this.arrayLike,r=this.scheduler,n=t.length;if(r)return r.schedule(o.dispatch,0,{arrayLike:t,index:0,length:n,subscriber:e});for(var i=0;i<n&&!e.closed;i++)e.next(t[i]);e.complete()},o}(i.Observable);r.ArrayLikeObservable=o},{"../Observable":4,"./EmptyObservable":23,"./ScalarObservable":28}],22:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../Observable"),s=e("./ScalarObservable"),u=e("./EmptyObservable"),a=e("../util/isScheduler"),o=function(r){function o(e,t){r.call(this),this.array=e,(this.scheduler=t)||1!==e.length||(this._isScalar=!0,this.value=e[0])}return n(o,r),o.create=function(e,t){return new o(e,t)},o.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=e[e.length-1];a.isScheduler(r)?e.pop():r=null;var n=e.length;return 1<n?new o(e,r):1===n?new s.ScalarObservable(e[0],r):new u.EmptyObservable(r)},o.dispatch=function(e){var t=e.array,r=e.index,n=e.count,i=e.subscriber;n<=r?i.complete():(i.next(t[r]),i.closed||(e.index=r+1,this.schedule(e)))},o.prototype._subscribe=function(e){var t=this.array,r=t.length,n=this.scheduler;if(n)return n.schedule(o.dispatch,0,{array:t,index:0,count:r,subscriber:e});for(var i=0;i<r&&!e.closed;i++)e.next(t[i]);e.complete()},o}(i.Observable);r.ArrayObservable=o},{"../Observable":4,"../util/isScheduler":60,"./EmptyObservable":23,"./ScalarObservable":28}],23:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=function(t){function r(e){t.call(this),this.scheduler=e}return n(r,t),r.create=function(e){return new r(e)},r.dispatch=function(e){e.subscriber.complete()},r.prototype._subscribe=function(e){var t=this.scheduler;if(t)return t.schedule(r.dispatch,0,{subscriber:e});e.complete()},r}(e("../Observable").Observable);r.EmptyObservable=i},{"../Observable":4}],24:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../Observable"),o=e("../util/tryCatch"),s=e("../util/isFunction"),u=e("../util/errorObject"),y=e("../Subscription"),m=Object.prototype.toString;var a=function(i){function v(e,t,r,n){i.call(this),this.sourceObj=e,this.eventName=t,this.selector=r,this.options=n}return n(v,i),v.create=function(e,t,r,n){return s.isFunction(r)&&(n=r,r=void 0),new v(e,t,n,r)},v.setupSubscription=function(e,t,r,n,i){var o,s,u,a,c,l;if((l=e)&&"[object NodeList]"===m.call(l)||(c=e)&&"[object HTMLCollection]"===m.call(c))for(var f=0,h=e.length;f<h;f++)v.setupSubscription(e[f],t,r,n,i);else if((a=e)&&"function"==typeof a.addEventListener&&"function"==typeof a.removeEventListener){var p=e;e.addEventListener(t,r,i),o=function(){return p.removeEventListener(t,r,i)}}else if((u=e)&&"function"==typeof u.on&&"function"==typeof u.off){var d=e;e.on(t,r),o=function(){return d.off(t,r)}}else{if(!(s=e)||"function"!=typeof s.addListener||"function"!=typeof s.removeListener)throw new TypeError("Invalid event target");var b=e;e.addListener(t,r),o=function(){return b.removeListener(t,r)}}n.add(new y.Subscription(o))},v.prototype._subscribe=function(n){var e=this.sourceObj,t=this.eventName,r=this.options,i=this.selector;v.setupSubscription(e,t,i?function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=o.tryCatch(i).apply(void 0,e);r===u.errorObject?n.error(u.errorObject.e):n.next(r)}:function(e){return n.next(e)},n,r)},v}(i.Observable);r.FromEventObservable=a},{"../Observable":4,"../Subscription":10,"../util/errorObject":54,"../util/isFunction":57,"../util/tryCatch":66}],25:[function(e,t,r){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=e("../util/isArray"),u=e("../util/isArrayLike"),a=e("../util/isPromise"),c=e("./PromiseObservable"),l=e("./IteratorObservable"),f=e("./ArrayObservable"),h=e("./ArrayLikeObservable"),p=e("../symbol/iterator"),d=e("../Observable"),b=e("../operators/observeOn"),v=e("../symbol/observable"),n=function(r){function n(e,t){r.call(this,null),this.ish=e,this.scheduler=t}return o(n,r),n.create=function(e,t){if(null!=e){if("function"==typeof e[v.observable])return e instanceof d.Observable&&!t?e:new n(e,t);if(s.isArray(e))return new f.ArrayObservable(e,t);if(a.isPromise(e))return new c.PromiseObservable(e,t);if("function"==typeof e[p.iterator]||"string"==typeof e)return new l.IteratorObservable(e,t);if(u.isArrayLike(e))return new h.ArrayLikeObservable(e,t)}throw new TypeError((null!==e&&(void 0===e?"undefined":i(e))||e)+" is not observable")},n.prototype._subscribe=function(e){var t=this.ish,r=this.scheduler;return null==r?t[v.observable]().subscribe(e):t[v.observable]().subscribe(new b.ObserveOnSubscriber(e,r,0))},n}(d.Observable);r.FromObservable=n},{"../Observable":4,"../operators/observeOn":45,"../symbol/iterator":48,"../symbol/observable":49,"../util/isArray":55,"../util/isArrayLike":56,"../util/isPromise":59,"./ArrayLikeObservable":21,"./ArrayObservable":22,"./IteratorObservable":26,"./PromiseObservable":27}],26:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("../util/root"),i=e("../Observable"),s=e("../symbol/iterator"),u=function(r){function i(e,t){if(r.call(this),this.scheduler=t,null==e)throw new Error("iterator cannot be null.");this.iterator=function(e){var t=e[s.iterator];if(!t&&"string"==typeof e)return new a(e);if(!t&&void 0!==e.length)return new c(e);if(!t)throw new TypeError("object is not iterable");return e[s.iterator]()}(e)}return n(i,r),i.create=function(e,t){return new i(e,t)},i.dispatch=function(e){var t=e.index,r=e.hasError,n=e.iterator,i=e.subscriber;if(r)i.error(e.error);else{var o=n.next();o.done?i.complete():(i.next(o.value),e.index=t+1,i.closed?"function"==typeof n.return&&n.return():this.schedule(e))}},i.prototype._subscribe=function(e){var t=this.iterator,r=this.scheduler;if(r)return r.schedule(i.dispatch,0,{index:0,iterator:t,subscriber:e});for(;;){var n=t.next();if(n.done){e.complete();break}if(e.next(n.value),e.closed){"function"==typeof t.return&&t.return();break}}},i}(i.Observable);r.IteratorObservable=u;var a=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length),this.str=e,this.idx=t,this.len=r}return e.prototype[s.iterator]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}},e}(),c=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=function(e){var t=+e.length;if(isNaN(t))return 0;if(0===t||(r=t,"number"!=typeof r||!o.root.isFinite(r)))return t;var r;if(n=t,i=+n,(t=(0===i?i:isNaN(i)?i:i<0?-1:1)*Math.floor(Math.abs(t)))<=0)return 0;var n,i;if(l<t)return l;return t}(e)),this.arr=e,this.idx=t,this.len=r}return e.prototype[s.iterator]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}},e}();var l=Math.pow(2,53)-1},{"../Observable":4,"../symbol/iterator":48,"../util/root":63}],27:[function(e,t,r){"use strict";var i=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("../util/root"),n=function(r){function n(e,t){r.call(this),this.promise=e,this.scheduler=t}return i(n,r),n.create=function(e,t){return new n(e,t)},n.prototype._subscribe=function(t){var r=this,e=this.promise,n=this.scheduler;if(null==n)this._isScalar?t.closed||(t.next(this.value),t.complete()):e.then(function(e){r.value=e,r._isScalar=!0,t.closed||(t.next(e),t.complete())},function(e){t.closed||t.error(e)}).then(null,function(e){o.root.setTimeout(function(){throw e})});else if(this._isScalar){if(!t.closed)return n.schedule(s,0,{value:this.value,subscriber:t})}else e.then(function(e){r.value=e,r._isScalar=!0,t.closed||t.add(n.schedule(s,0,{value:e,subscriber:t}))},function(e){t.closed||t.add(n.schedule(u,0,{err:e,subscriber:t}))}).then(null,function(e){o.root.setTimeout(function(){throw e})})},n}(e("../Observable").Observable);function s(e){var t=e.value,r=e.subscriber;r.closed||(r.next(t),r.complete())}function u(e){var t=e.err,r=e.subscriber;r.closed||r.error(t)}r.PromiseObservable=n},{"../Observable":4,"../util/root":63}],28:[function(e,t,r){"use strict";var i=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},n=function(r){function n(e,t){r.call(this),this.value=e,this.scheduler=t,this._isScalar=!0,t&&(this._isScalar=!1)}return i(n,r),n.create=function(e,t){return new n(e,t)},n.dispatch=function(e){var t=e.done,r=e.value,n=e.subscriber;t?n.complete():(n.next(r),n.closed||(e.done=!0,this.schedule(e)))},n.prototype._subscribe=function(e){var t=this.value,r=this.scheduler;if(r)return r.schedule(n.dispatch,0,{done:!1,value:t,subscriber:e});e.next(t),e.closed||e.complete()},n}(e("../Observable").Observable);r.ScalarObservable=n},{"../Observable":4}],29:[function(e,t,r){"use strict";var i=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},u=e("../../util/root"),f=e("../../util/tryCatch"),h=e("../../util/errorObject"),n=e("../../Observable"),o=e("../../Subscriber"),s=e("../../operators/map");function a(e,t){return void 0===t&&(t=null),new y({method:"GET",url:e,headers:t})}function c(e,t,r){return new y({method:"POST",url:e,body:t,headers:r})}function l(e,t){return new y({method:"DELETE",url:e,headers:t})}function p(e,t,r){return new y({method:"PUT",url:e,body:t,headers:r})}function d(e,t,r){return new y({method:"PATCH",url:e,body:t,headers:r})}r.ajaxGet=a,r.ajaxPost=c,r.ajaxDelete=l,r.ajaxPut=p,r.ajaxPatch=d;var b=s.map(function(e,t){return e.response});function v(e,t){return b(new y({method:"GET",url:e,responseType:"json",headers:t}))}r.ajaxGetJSON=v;var y=function(n){function t(e){n.call(this);var t={async:!0,createXHR:function(){return this.crossDomain?function(){if(u.root.XMLHttpRequest)return new u.root.XMLHttpRequest;if(u.root.XDomainRequest)return new u.root.XDomainRequest;throw new Error("CORS is not supported by your browser")}.call(this):function(){if(u.root.XMLHttpRequest)return new u.root.XMLHttpRequest;var e=void 0;try{for(var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=0;r<3;r++)try{if(e=t[r],new u.root.ActiveXObject(e))break}catch(e){}return new u.root.ActiveXObject(e)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!1,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof e)t.url=e;else for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);this.request=t}var e;return i(t,n),t.prototype._subscribe=function(e){return new m(e,this.request)},t.create=((e=function(e){return new t(e)}).get=a,e.post=c,e.delete=l,e.put=p,e.patch=d,e.getJSON=v,e),t}(n.Observable);r.AjaxObservable=y;var m=function(n){function e(e,t){n.call(this,e),this.request=t,this.done=!1;var r=t.headers=t.headers||{};t.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),"Content-Type"in r||u.root.FormData&&t.body instanceof u.root.FormData||void 0===t.body||(r["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),t.body=this.serializeBody(t.body,t.headers["Content-Type"]),this.send()}return i(e,n),e.prototype.next=function(e){this.done=!0;var t=this.xhr,r=this.request,n=this.destination,i=new g(e,t,r);n.next(i)},e.prototype.send=function(){var e=this.request,t=this.request,r=t.user,n=t.method,i=t.url,o=t.async,s=t.password,u=t.headers,a=t.body,c=e.createXHR,l=f.tryCatch(c).call(e);if(l===h.errorObject)this.error(h.errorObject.e);else{this.xhr=l,this.setupEvents(l,e);if((r?f.tryCatch(l.open).call(l,n,i,o,r,s):f.tryCatch(l.open).call(l,n,i,o))===h.errorObject)return this.error(h.errorObject.e),null;if(o&&(l.timeout=e.timeout,l.responseType=e.responseType),"withCredentials"in l&&(l.withCredentials=!!e.withCredentials),this.setHeaders(l,u),(a?f.tryCatch(l.send).call(l,a):f.tryCatch(l.send).call(l))===h.errorObject)return this.error(h.errorObject.e),null}return l},e.prototype.serializeBody=function(t,e){if(!t||"string"==typeof t)return t;if(u.root.FormData&&t instanceof u.root.FormData)return t;if(e){var r=e.indexOf(";");-1!==r&&(e=e.substring(0,r))}switch(e){case"application/x-www-form-urlencoded":return Object.keys(t).map(function(e){return encodeURI(e)+"="+encodeURI(t[e])}).join("&");case"application/json":return JSON.stringify(t);default:return t}},e.prototype.setHeaders=function(e,t){for(var r in t)t.hasOwnProperty(r)&&e.setRequestHeader(r,t[r])},e.prototype.setupEvents=function(e,t){var r=t.progressSubscriber;function i(e){var t=i.subscriber,r=i.progressSubscriber,n=i.request;r&&r.error(e),t.error(new O(this,n))}if((e.ontimeout=i).request=t,i.subscriber=this,i.progressSubscriber=r,e.upload&&"withCredentials"in e){var n,o;if(r)n=function(e){n.progressSubscriber.next(e)},u.root.XDomainRequest?e.onprogress=n:e.upload.onprogress=n,n.progressSubscriber=r;o=function(e){var t=o,r=t.progressSubscriber,n=t.subscriber,i=t.request;r&&r.error(e),n.error(new w("ajax error",this,i))},(e.onerror=o).request=t,o.subscriber=this,o.progressSubscriber=r}function s(e){var t=s.subscriber,r=s.progressSubscriber,n=s.request;if(4===this.readyState){var i=1223===this.status?204:this.status,o="text"===this.responseType?this.response||this.responseText:this.response;0===i&&(i=o?200:0),200<=i&&i<300?(r&&r.complete(),t.next(e),t.complete()):(r&&r.error(e),t.error(new w("ajax error "+i,this,n)))}}(e.onreadystatechange=s).subscriber=this,s.progressSubscriber=r,s.request=t},e.prototype.unsubscribe=function(){var e=this.done,t=this.xhr;!e&&t&&4!==t.readyState&&"function"==typeof t.abort&&t.abort(),n.prototype.unsubscribe.call(this)},e}(o.Subscriber);r.AjaxSubscriber=m;var g=function(e,t,r){this.originalEvent=e,this.xhr=t,this.request=r,this.status=t.status,this.responseType=t.responseType||r.responseType,this.response=_(this.responseType,t)};r.AjaxResponse=g;var w=function(n){function e(e,t,r){n.call(this,e),this.message=e,this.xhr=t,this.request=r,this.status=t.status,this.responseType=t.responseType||r.responseType,this.response=_(this.responseType,t)}return i(e,n),e}(Error);function _(e,t){switch(e){case"json":return"response"in t?t.responseType?t.response:JSON.parse(t.response||t.responseText||"null"):JSON.parse(t.responseText||"null");case"xml":return t.responseXML;case"text":default:return"response"in t?t.response:t.responseText}}var O=function(r){function e(e,t){r.call(this,"ajax timeout",e,t)}return i(e,r),e}(r.AjaxError=w);r.AjaxTimeoutError=O},{"../../Observable":4,"../../Subscriber":9,"../../operators/map":43,"../../util/errorObject":54,"../../util/root":63,"../../util/tryCatch":66}],30:[function(e,t,r){"use strict";var n=e("./FromObservable");r.from=n.FromObservable.create},{"./FromObservable":25}],31:[function(e,t,r){"use strict";var n=e("./FromEventObservable");r.fromEvent=n.FromEventObservable.create},{"./FromEventObservable":24}],32:[function(e,t,r){"use strict";var n=e("./PromiseObservable");r.fromPromise=n.PromiseObservable.create},{"./PromiseObservable":27}],33:[function(e,t,r){"use strict";var n=e("../operators/catchError");r._catch=function(e){return n.catchError(e)(this)}},{"../operators/catchError":40}],34:[function(e,t,r){"use strict";var n=e("../operators/distinct");r.distinct=function(e,t){return n.distinct(e,t)(this)}},{"../operators/distinct":41}],35:[function(e,t,r){"use strict";var n=e("../operators/filter");r.filter=function(e,t){return n.filter(e,t)(this)}},{"../operators/filter":42}],36:[function(e,t,r){"use strict";var n=e("../operators/map");r.map=function(e,t){return n.map(e,t)(this)}},{"../operators/map":43}],37:[function(e,t,r){"use strict";var n=e("../operators/mergeMap");r.mergeMap=function(e,t,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),n.mergeMap(e,t,r)(this)}},{"../operators/mergeMap":44}],38:[function(e,t,r){"use strict";var n=e("../operators/retry");r.retry=function(e){return void 0===e&&(e=-1),n.retry(e)(this)}},{"../operators/retry":46}],39:[function(e,t,r){"use strict";var n=e("../operators/retryWhen");r.retryWhen=function(e){return n.retryWhen(e)(this)}},{"../operators/retryWhen":47}],40:[function(e,t,r){"use strict";var i=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},n=e("../OuterSubscriber"),o=e("../util/subscribeToResult");r.catchError=function(n){return function(e){var t=new s(n),r=e.lift(t);return t.caught=r}};var s=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.selector,this.caught))},e}(),u=function(n){function e(e,t,r){n.call(this,e),this.selector=t,this.caught=r}return i(e,n),e.prototype.error=function(e){if(!this.isStopped){var t=void 0;try{t=this.selector(e,this.caught)}catch(e){return void n.prototype.error.call(this,e)}this._unsubscribeAndRecycle(),this.add(o.subscribeToResult(this,t))}},e}(n.OuterSubscriber)},{"../OuterSubscriber":6,"../util/subscribeToResult":64}],41:[function(e,t,r){"use strict";var i=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},n=e("../OuterSubscriber"),o=e("../util/subscribeToResult"),s=e("../util/Set");r.distinct=function(t,r){return function(e){return e.lift(new u(t,r))}};var u=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.keySelector,this.flushes))},e}(),a=function(n){function e(e,t,r){n.call(this,e),this.keySelector=t,this.values=new s.Set,r&&this.add(o.subscribeToResult(this,r))}return i(e,n),e.prototype.notifyNext=function(e,t,r,n,i){this.values.clear()},e.prototype.notifyError=function(e,t){this._error(e)},e.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},e.prototype._useKeySelector=function(e){var t,r=this.destination;try{t=this.keySelector(e)}catch(e){return void r.error(e)}this._finalizeNext(t,e)},e.prototype._finalizeNext=function(e,t){var r=this.values;r.has(e)||(r.add(e),this.destination.next(t))},e}(n.OuterSubscriber);r.DistinctSubscriber=a},{"../OuterSubscriber":6,"../util/Set":52,"../util/subscribeToResult":64}],42:[function(e,t,r){"use strict";var i=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},n=e("../Subscriber");r.filter=function(t,r){return function(e){return e.lift(new o(t,r))}};var o=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.thisArg))},e}(),s=function(n){function e(e,t,r){n.call(this,e),this.predicate=t,this.thisArg=r,this.count=0}return i(e,n),e.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},e}(n.Subscriber)},{"../Subscriber":9}],43:[function(e,t,r){"use strict";var i=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},n=e("../Subscriber");r.map=function(t,r){return function(e){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return e.lift(new o(t,r))}};var o=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.project,this.thisArg))},e}();r.MapOperator=o;var s=function(n){function e(e,t,r){n.call(this,e),this.project=t,this.count=0,this.thisArg=r||this}return i(e,n),e.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},e}(n.Subscriber)},{"../Subscriber":9}],44:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("../util/subscribeToResult"),i=e("../OuterSubscriber");r.mergeMap=function(t,r,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(e){return"number"==typeof r&&(n=r,r=null),e.lift(new s(t,r,n))}};var s=function(){function e(e,t,r){void 0===r&&(r=Number.POSITIVE_INFINITY),this.project=e,this.resultSelector=t,this.concurrent=r}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.project,this.resultSelector,this.concurrent))},e}();r.MergeMapOperator=s;var u=function(i){function e(e,t,r,n){void 0===n&&(n=Number.POSITIVE_INFINITY),i.call(this,e),this.project=t,this.resultSelector=r,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return n(e,i),e.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},e.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t,e,r)},e.prototype._innerSub=function(e,t,r){this.add(o.subscribeToResult(this,e,t,r))},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},e.prototype.notifyNext=function(e,t,r,n,i){this.resultSelector?this._notifyResultSelector(e,t,r,n):this.destination.next(t)},e.prototype._notifyResultSelector=function(e,t,r,n){var i;try{i=this.resultSelector(e,t,r,n)}catch(e){return void this.destination.error(e)}this.destination.next(i)},e.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,0<t.length?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(i.OuterSubscriber);r.MergeMapSubscriber=u},{"../OuterSubscriber":6,"../util/subscribeToResult":64}],45:[function(e,t,r){"use strict";var i=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},n=e("../Subscriber"),o=e("../Notification");r.observeOn=function(t,r){return void 0===r&&(r=0),function(e){return e.lift(new s(t,r))}};var s=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.scheduler,this.delay))},e}();r.ObserveOnOperator=s;var u=function(n){function t(e,t,r){void 0===r&&(r=0),n.call(this,e),this.scheduler=t,this.delay=r}return i(t,n),t.dispatch=function(e){var t=e.notification,r=e.destination;t.observe(r),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.add(this.scheduler.schedule(t.dispatch,this.delay,new a(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(o.Notification.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(o.Notification.createError(e))},t.prototype._complete=function(){this.scheduleMessage(o.Notification.createComplete())},t}(n.Subscriber);r.ObserveOnSubscriber=u;var a=function(e,t){this.notification=e,this.destination=t};r.ObserveOnMessage=a},{"../Notification":3,"../Subscriber":9}],46:[function(e,t,r){"use strict";var i=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},n=e("../Subscriber");r.retry=function(t){return void 0===t&&(t=-1),function(e){return e.lift(new o(t,e))}};var o=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.count,this.source))},e}(),s=function(n){function e(e,t,r){n.call(this,e),this.count=t,this.source=r}return i(e,n),e.prototype.error=function(e){if(!this.isStopped){var t=this.source,r=this.count;if(0===r)return n.prototype.error.call(this,e);-1<r&&(this.count=r-1),t.subscribe(this._unsubscribeAndRecycle())}},e}(n.Subscriber)},{"../Subscriber":9}],47:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("../Subject"),s=e("../util/tryCatch"),u=e("../util/errorObject"),i=e("../OuterSubscriber"),a=e("../util/subscribeToResult");r.retryWhen=function(t){return function(e){return e.lift(new c(t,e))}};var c=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.notifier,this.source))},e}(),l=function(i){function e(e,t,r){i.call(this,e),this.notifier=t,this.source=r}return n(e,i),e.prototype.error=function(e){if(!this.isStopped){var t=this.errors,r=this.retries,n=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{if(t=new o.Subject,(r=s.tryCatch(this.notifier)(t))===u.errorObject)return i.prototype.error.call(this,u.errorObject.e);n=a.subscribeToResult(this,r)}this._unsubscribeAndRecycle(),this.errors=t,this.retries=r,this.retriesSubscription=n,t.next(e)}},e.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},e.prototype.notifyNext=function(e,t,r,n,i){var o=this.errors,s=this.retries,u=this.retriesSubscription;this.errors=null,this.retries=null,this.retriesSubscription=null,this._unsubscribeAndRecycle(),this.errors=o,this.retries=s,this.retriesSubscription=u,this.source.subscribe(this)},e}(i.OuterSubscriber)},{"../OuterSubscriber":6,"../Subject":7,"../util/errorObject":54,"../util/subscribeToResult":64,"../util/tryCatch":66}],48:[function(e,t,r){"use strict";var n=e("../util/root");function i(e){var t=e.Symbol;if("function"==typeof t)return t.iterator||(t.iterator=t("iterator polyfill")),t.iterator;var r=e.Set;if(r&&"function"==typeof(new r)["@@iterator"])return"@@iterator";var n=e.Map;if(n)for(var i=Object.getOwnPropertyNames(n.prototype),o=0;o<i.length;++o){var s=i[o];if("entries"!==s&&"size"!==s&&n.prototype[s]===n.prototype.entries)return s}return"@@iterator"}r.symbolIteratorPonyfill=i,r.iterator=i(n.root),r.$$iterator=r.iterator},{"../util/root":63}],49:[function(e,t,r){"use strict";var n=e("../util/root");function i(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.getSymbolObservable=i,r.observable=i(n.root),r.$$observable=r.observable},{"../util/root":63}],50:[function(e,t,r){"use strict";var n=e("../util/root").root.Symbol;r.rxSubscriber="function"==typeof n&&"function"==typeof n.for?n.for("rxSubscriber"):"@@rxSubscriber",r.$$rxSubscriber=r.rxSubscriber},{"../util/root":63}],51:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=function(t){function e(){var e=t.call(this,"object unsubscribed");this.name=e.name="ObjectUnsubscribedError",this.stack=e.stack,this.message=e.message}return n(e,t),e}(Error);r.ObjectUnsubscribedError=i},{}],52:[function(e,t,r){"use strict";var n=e("./root");function i(){return function(){function e(){this._values=[]}return e.prototype.add=function(e){this.has(e)||this._values.push(e)},e.prototype.has=function(e){return-1!==this._values.indexOf(e)},Object.defineProperty(e.prototype,"size",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._values.length=0},e}()}r.minimalSetImpl=i,r.Set=n.root.Set||i()},{"./root":63}],53:[function(e,t,r){"use strict";var n=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=function(r){function e(e){r.call(this),this.errors=e;var t=Error.call(this,e?e.length+" errors occurred during unsubscription:\n  "+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"");this.name=t.name="UnsubscriptionError",this.stack=t.stack,this.message=t.message}return n(e,r),e}(Error);r.UnsubscriptionError=i},{}],54:[function(e,t,r){"use strict";r.errorObject={e:{}}},{}],55:[function(e,t,r){"use strict";r.isArray=Array.isArray||function(e){return e&&"number"==typeof e.length}},{}],56:[function(e,t,r){"use strict";r.isArrayLike=function(e){return e&&"number"==typeof e.length}},{}],57:[function(e,t,r){"use strict";r.isFunction=function(e){return"function"==typeof e}},{}],58:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.isObject=function(e){return null!=e&&"object"===(void 0===e?"undefined":n(e))}},{}],59:[function(e,t,r){"use strict";r.isPromise=function(e){return e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}},{}],60:[function(e,t,r){"use strict";r.isScheduler=function(e){return e&&"function"==typeof e.schedule}},{}],61:[function(e,t,r){"use strict";r.noop=function(){}},{}],62:[function(e,t,r){"use strict";var n=e("./noop");function i(t){return t?1===t.length?t[0]:function(e){return t.reduce(function(e,t){return t(e)},e)}:n.noop}r.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i(e)},r.pipeFromArray=i},{"./noop":61}],63:[function(e,t,i){(function(e){"use strict";var t="undefined"!=typeof window&&window,r="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,n=t||void 0!==e&&e||r;i.root=n,function(){if(!n)throw new Error("RxJS could not find any global context (window, self, global)")}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],64:[function(e,t,r){"use strict";var f=e("./root"),h=e("./isArrayLike"),p=e("./isPromise"),d=e("./isObject"),b=e("../Observable"),v=e("../symbol/iterator"),y=e("../InnerSubscriber"),m=e("../symbol/observable");r.subscribeToResult=function(e,t,r,n){var i=new y.InnerSubscriber(e,r,n);if(i.closed)return null;if(t instanceof b.Observable)return t._isScalar?(i.next(t.value),i.complete(),null):(i.syncErrorThrowable=!0,t.subscribe(i));if(h.isArrayLike(t)){for(var o=0,s=t.length;o<s&&!i.closed;o++)i.next(t[o]);i.closed||i.complete()}else{if(p.isPromise(t))return t.then(function(e){i.closed||(i.next(e),i.complete())},function(e){return i.error(e)}).then(null,function(e){f.root.setTimeout(function(){throw e})}),i;if(t&&"function"==typeof t[v.iterator])for(var u=t[v.iterator]();;){var a=u.next();if(a.done){i.complete();break}if(i.next(a.value),i.closed)break}else if(t&&"function"==typeof t[m.observable]){var c=t[m.observable]();if("function"==typeof c.subscribe)return c.subscribe(new y.InnerSubscriber(e,r,n));i.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var l="You provided "+(d.isObject(t)?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";i.error(new TypeError(l))}}return null}},{"../InnerSubscriber":2,"../Observable":4,"../symbol/iterator":48,"../symbol/observable":49,"./isArrayLike":56,"./isObject":58,"./isPromise":59,"./root":63}],65:[function(e,t,r){"use strict";var n=e("../Subscriber"),i=e("../symbol/rxSubscriber"),o=e("../Observer");r.toSubscriber=function(e,t,r){if(e){if(e instanceof n.Subscriber)return e;if(e[i.rxSubscriber])return e[i.rxSubscriber]()}return e||t||r?new n.Subscriber(e,t,r):new n.Subscriber(o.empty)}},{"../Observer":5,"../Subscriber":9,"../symbol/rxSubscriber":50}],66:[function(e,t,r){"use strict";var n,i=e("./errorObject");function o(){try{return n.apply(this,arguments)}catch(e){return i.errorObject.e=e,i.errorObject}}r.tryCatch=function(e){return n=e,o}},{"./errorObject":54}],67:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=e("rxjs/Observable"),s=e("rxjs/observable/dom/AjaxObservable");e("rxjs/add/operator/map"),e("rxjs/add/operator/filter"),e("rxjs/add/operator/mergeMap"),e("rxjs/add/operator/distinct"),e("rxjs/add/operator/catch"),e("rxjs/add/observable/from"),e("rxjs/add/observable/fromEvent"),e("rxjs/add/observable/fromPromise"),e("rxjs/add/operator/retry"),e("rxjs/add/operator/retryWhen");var o,u=e("dexie"),a=(o=u)&&o.__esModule?o:{default:o};var c=function(){function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o)}return n(o,null,[{key:"createIndexedDB",value:function(e){return new a.default(e)}},{key:"getIndexedFavoriteRequests",value:function(e){return i.Observable.fromPromise(e.favoriteRequests.toArray()).mergeMap(function(e){return e})}},{key:"getIndexedReviewRequests",value:function(e){return i.Observable.fromPromise(e.reviewRequests.toArray()).mergeMap(function(e){return e})}},{key:"getIndexedRestaurants",value:function(e){return i.Observable.fromPromise(e[o.DATABASE_NAME].toArray()).mergeMap(function(e){return e})}},{key:"getIndexedReviews",value:function(e){return i.Observable.fromPromise(e.reviews.toArray()).mergeMap(function(e){return e})}},{key:"createIndexedStores",value:function(r,n){return new Promise(function(e,t){try{return r.version(o.DATABASE_VERSION).stores(n)}catch(e){if("Cannot add version when database is open"===e.message)return r.close(),r.version(o.DATABASE_VERSION).stores(n),r.open()}e(r)})}},{key:"deleteIndexedDB",value:function(e){return e.delete()}},{key:"initIndexedDB",value:function(e){return e.open()}},{key:"addIDBEventListener",value:function(e,t,r){e.on(t,r)}},{key:"ifIndexedDBEmpty",value:function(e,n){return new Promise(function(t,r){o.addIDBEventListener(e,"ready",function(){return e[n].count(function(e){return 0===e?t():r("DB not empty")})})})}},{key:"indexedTableOpen",value:function(e,t){return e.transaction("rw",o.DATABASE_NAME,function(){return t()})}},{key:"fetchRestaurants",value:function(e){return s.AjaxObservable.create.getJSON(o.API_URL).retry(2).mergeMap(function(e){return i.Observable.from(e)}).catch(function(){return o.getIndexedRestaurants(e)})}},{key:"fetchReviewsByID",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return s.AjaxObservable.create.getJSON("./"+t+"reviews/?restaurant_id="+e)}},{key:"addReviewByRestaurant",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return s.AjaxObservable.create.post("./"+t+"reviews/",e)}},{key:"removeReviewByID",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return s.AjaxObservable.create.delete("./"+t+"reviews/"+e)}},{key:"entryExists",value:function(n,i){return new Promise(function(t,r){n.transaction("rw",o.DATABASE_NAME,function(){var e;(e=n[o.DATABASE_NAME]).get.apply(e,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(i)).then(function(e){return t(e)}).catch(function(e){r(e)})})})}},{key:"needsUpdate",value:function(){return new Promise(function(e,t){var r=new XMLHttpRequest;r.open("HEAD",url),r.onreadystatechange=function(){this.readyState===this.DONE?304!==this.status&&404!==this.status&&e():t()},r.send()})}},{key:"fetchRestaurantById",value:function(t,e){return s.AjaxObservable.create.getJSON(""+o.API_URL+t).catch(function(){return o.getIndexedRestaurants(e).filter(function(e){return e.id===Number(t)})})}},{key:"fetchRestaurantByCuisine",value:function(e,t,r){return e.filter(function(e){return e.cuisine_type===t}).subscribe(function(e){return r(null,e)},function(e){return r(e,null)})}},{key:"fetchRestaurantByNeighborhood",value:function(e,t,r){return e.filter(function(e){return e.neighborhood===t}).subscribe(function(e){return r(null,e)},function(e){return r(e,null)})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(e,t,r){return e.filter(function(e){return("all"!==t&&e.cuisine_type===t||"all"===t)&&("all"!==r&&e.neighborhood===r||"all"===r)})}},{key:"fetchNeighborhoods",value:function(e){return e.map(function(e){return e.neighborhood}).distinct()}},{key:"fetchCuisines",value:function(e){return e.map(function(e){return e.cuisine_type}).distinct()}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:o.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"API_URL",get:function(){return"/restaurants/"}},{key:"DATABASE_NAME",get:function(){return"restaurants"}},{key:"DATABASE_VERSION",get:function(){return 1}}]),o}();c.setFavorite=function(e,t){return s.AjaxObservable.create.put("./restaurants/"+e+"/?is_favorite="+t)},c.urlForRestaurant=function(e){return"./review?id="+e.id},c.imageUrlForRestaurant=function(e){return"./../img/"+(void 0!==e.photograph?e.photograph:"placeholder")},r.default=c},{dexie:1,"rxjs/Observable":4,"rxjs/add/observable/from":11,"rxjs/add/observable/fromEvent":12,"rxjs/add/observable/fromPromise":13,"rxjs/add/operator/catch":14,"rxjs/add/operator/distinct":15,"rxjs/add/operator/filter":16,"rxjs/add/operator/map":17,"rxjs/add/operator/mergeMap":18,"rxjs/add/operator/retry":19,"rxjs/add/operator/retryWhen":20,"rxjs/observable/dom/AjaxObservable":29}],68:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getDataAttributes=r.createResponsiveImg=void 0;var n,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=e("./DBHelper"),a=(n=o)&&n.__esModule?n:{default:n},s=e("rxjs/Observable"),c=e("rxjs/Subject");e("rxjs/add/operator/map"),e("rxjs/add/operator/mergeMap"),e("rxjs/add/operator/filter"),e("rxjs/add/observable/from"),e("rxjs/add/observable/fromEvent");var l=e("./toast");function f(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var u=function o(){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.state={restaurants:null,neighborhoods:[],cuisines:[],map:null,markers:[],indexedDB:null,thumbnails:[]},this.ONLINE$=s.Observable.fromEvent(window,"online"),this.OFFLINE$=s.Observable.fromEvent(window,"offline").subscribe(function(){(0,l.toast)("It looks, you're offline. All requests will be send after connection reestablishing.","info")}),this.setState=function(e){return u.state=i({},u.state,e)},this.removeFavoriteListeners=function(){[].concat(f(document.getElementsByClassName("markAsFavorite"))).map(function(e){return e.removeEventListener("click",e)})},this.setFavoriteListeners=function(){u.removeFavoriteListeners(),[].concat(f(document.getElementsByClassName("markAsFavorite"))).map(function(i){return i.addEventListener("click",function(e){e.preventDefault();var t=o.getDataAttributes(i.attributes),r=t.id,n=t.favorite;u.toggleFavorite(Number(r),JSON.parse(n),i)})})},this.fetchNeighborhoods=function(){var e=function(e){return u.state.neighborhoods=[],a.default.fetchNeighborhoods(e).subscribe(function(e){u.state.neighborhoods.push(e),u.fillNeighborhoodsHTML(e)},function(e){return console.error(e)})};u.state.restaurants&&0!==u.state.restaurants.length?e(u.state.restaurants):e(u.setRestaurants())},this.fillNeighborhoodsHTML=function(e){var t=document.getElementById("neighborhoods-select"),r=document.createElement("option");r.innerHTML=e,r.value=e;try{t.append(r)}catch(e){t.innerHTML+=r.outerHTML}return r},this.fetchCuisines=function(){u.state.cuisines=[],a.default.fetchCuisines(u.state.restaurants).subscribe(function(e){u.state.cuisines.push(e),u.fillCuisinesHTML(e)},function(e){return console.error(e)})},this.fillCuisinesHTML=function(e){var t=document.getElementById("cuisines-select"),r=document.createElement("option");r.innerHTML=e,r.value=e;try{t.append(r)}catch(e){t.innerHTML+=r.outerHTML}return r},this.setRestaurants=function(){u.state.restaurants=new c.Subject;var t=a.default.createIndexedDB(a.default.DATABASE_NAME);return a.default.createIndexedStores(t,{restaurants:"id++,name,neighborhood,cuisine_type",favoriteRequests:"id++,restaurantID"}),u.resetRestaurants(),u.setState({indexedDB:t}),a.default.fetchRestaurants(t).map(function(e){return u.storeThumbnails(e),u.addMarkersToMap(e),u.state.restaurants.next(e),t[a.default.DATABASE_NAME].put(e).catch(console.error),e},function(e){return console.error(e)})},this.toggleFavorite=function(r,e,t){var n=t.children[0];t.setAttribute("data-favorite",!e),t.setAttribute("aria-checked",!e),e?t.setAttribute("aria-label","Unmark as favorite"):t.setAttribute("aria-label","Mark as favorite"),n.className="star "+(e?"":"favorite"),n.src=e?"./img/star_unchecked.png":"./img/star.png",u.state.indexedDB.restaurants.where("id").equals(r).modify({is_favorite:!e}),a.default.setFavorite(r,!e).catch(function(){return new Promise(function(e,t){navigator.serviceWorker?reg.sync&&reg.sync.getTags&&e(u.state.indexedDB.favoriteRequests.put({restaurantID:r}).then(reg.sync.register("syncFavorite"))):t()})}).subscribe()},this.updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),r=e.selectedIndex,n=t.selectedIndex,i=e[r].value,o=t[n].value,s=u.state.indexedDB;u.resetRestaurants(),a.default.fetchRestaurantByCuisineAndNeighborhood(a.default.fetchRestaurants(s),i,o).subscribe(function(e){u.storeThumbnails(e),u.addMarkersToMap(e)},function(e){return console.error(e)})},this.resetRestaurants=function(){u.state.thumbnails.length=0;document.getElementById("restaurants-list");u.removeFavoriteListeners(),u.state.markers=u.state.markers?u.state.markers:[],u.state.markers.forEach(function(e){return e.setMap(null)})},this.storeThumbnails=function(e){u.state.thumbnails.push({HTML:u.createRestaurantHTML(e),visible:!1})},this.fillRestaurantsHTML=function(t){var r=document.getElementById("restaurants-list");try{r.append(t)}catch(e){r.innerHTML+=t.outerHTML}},this.createRestaurantHTML=function(e){var t=document.createElement("div"),r="n"+String(Math.random()).split(".")[1],n=JSON.parse(void 0!==e.is_favorite?e.is_favorite:"false");return t.innerHTML=('<li role="listitem" aria-labelledby="'+r+'">\n<div id="'+r+'">\n<button class="markAsFavorite" aria-label="Mark as favorite" title="Mark as favorite" aria-live="assertive" role="switch" aria-checked="false" data-id="'+e.id+'" data-favorite="'+n+'">\n<img class="star '+(n?"favorite":"")+'" src="'+(n?"./img/star.png":"./img/star_unchecked.png")+'"\n alt="'+(n?"is favorite":"isn't favorite")+'">\n</button>\n<h2 role="heading">'+e.name+"</h2>\n<p>"+e.neighborhood+"</p>\n<p>"+e.address+'</p>\n</div>\n<a role="link" href="'+a.default.urlForRestaurant(e)+'">View Details</a></li>').replace(/>\s+</,"><"),[t.firstChild,o.createResponsiveImg(a.default.imageUrlForRestaurant(e),"Image of "+e.name+" restaurant")]},this.addMarkersToMap=function(e){var t=a.default.mapMarkerForRestaurant(e,u.state.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),u.state.markers.push(t)},document.getElementById("load-restaurants").addEventListener("click",function(e){e.preventDefault();var t=document.getElementById("restaurants-list");u.removeFavoriteListeners(),t.innerHTML="",u.state.thumbnails.map(function(e){e.HTML[0].innerHTML=e.HTML[1]+e.HTML[0].innerHTML,u.fillRestaurantsHTML(e.HTML[0]),e.visible=!0}),u.setFavoriteListeners()})};u.getDataAttributes=function(e){var t=[].concat(f(e)).filter(function(e){return/data/.test(e.name)}),r={};for(var n in t){var i=t[n],o=i.name,s=i.value;r[o.slice(5,o.length)]=s}return r},u.createResponsiveImg=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:".",n=e.split("."),i=n[n.length-1];return'<picture class="restaurant-img">\n  <source media="(max-width: 719px)"\n    srcset="'+(r+i)+"-100-1x.jpg 1x, "+(r+i)+"-100-2x.jpg 2x, "+(r+i)+'-100-3x.jpg 3x">\n  <source  media="(min-width: 720px)"\n    srcset=".'+e+'.jpg 1x">\n  <img class="restaurant-img" src="'+(r+i)+'.jpg" alt="'+t+'">\n</picture>'},r.default=u;r.createResponsiveImg=u.createResponsiveImg,r.getDataAttributes=u.getDataAttributes},{"./DBHelper":67,"./toast":71,"rxjs/Observable":4,"rxjs/Subject":7,"rxjs/add/observable/from":11,"rxjs/add/observable/fromEvent":12,"rxjs/add/operator/filter":16,"rxjs/add/operator/map":17,"rxjs/add/operator/mergeMap":18}],69:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),s=e("./DBHelper"),a=(n=s)&&n.__esModule?n:{default:n},c=e("./Restaurant"),l=e("rxjs/Observable"),f=e("./toast");var u=function(){function e(){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state={restaurant:null,map:null,indexedDB:null},this.ONLINE$=l.Observable.fromEvent(window,"online"),this.OFFLINE$=l.Observable.fromEvent(window,"offline").subscribe(function(){(0,f.toast)("It looks, you're offline. All requests will be send after connection reestablishing.","info")}),this.setState=function(e){return u.state=i({},u.state,e)},this.fetchRestaurantFromURL=function(t){var r=a.default.createIndexedDB(a.default.DATABASE_NAME);if(u.setState({indexedDB:r}),a.default.createIndexedStores(r,{restaurants:"id++,name,neighborhood,cuisine_type",reviews:"id++,name,restaurant_id,createdAt,updatedAt,rating,comments",reviewRequests:"id++,reviewID"}),u.state.restaurant)t(null,u.state.restaurant);else{var n=u.getParameterByName();if(n)console.log(r),a.default.fetchRestaurantById(n,r).subscribe(function(e){u.state.restaurant=e,r[a.default.DATABASE_NAME].put(e).catch(console.error),t(void 0,e),u.fillRestaurantHTML(e)},function(e){console.error("Got error "+e+" fetching restaurant ID: {"+n+"} from remote")});else{t("No restaurant id in URL",null)}}},this.fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:u.state.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address,document.getElementById("restaurant-img").outerHTML=(0,c.createResponsiveImg)(a.default.imageUrlForRestaurant(e),"Image of "+e.name+" restaurant","./.."),document.getElementsByClassName("restaurant-img")[1].id="restaurant-img",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&u.fillRestaurantHoursHTML(),u.fillReviewsHTML(a.default.fetchReviewsByID(u.state.restaurant.id,"../../"))},this.fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:u.state.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var r in e){var n=document.createElement("tr"),i=document.createElement("td");i.innerHTML=r,n.appendChild(i);var o=document.createElement("td");o.innerHTML=e[r],n.appendChild(o),t.appendChild(n)}},this.fillReviewsHTML=function(e){var r=document.getElementById("reviews-container"),t=document.createElement("h3");if(t.innerHTML="Reviews",r.appendChild(t),!e){var n=document.createElement("p");return n.innerHTML="No reviews yet!",void r.appendChild(n)}var i=document.getElementById("reviews-list"),o=u.state.indexedDB;console.log(o),e.catch(function(){return a.default.getIndexedReviews(o)}).mergeMap(function(e){return l.Observable.from(e)}).subscribe(function(e){i.appendChild(u.createReviewHTML(e)),o.reviews.put(e).catch(console.error)},function(e){console.error(e)},function(){r.appendChild(i),[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(i.children)).map(function(e){var t=(0,c.getDataAttributes)(e.attributes).review_id;u.addRemoveReviewListener(e,t)});var e=document.getElementById("maincontent"),t=document.getElementById("overlay");e.style.visibility="visible",t.style.display="none"})},this.createReviewHTML=function(e){var t=new Date(e.updatedAt).toLocaleDateString(),r=document.createElement("div");return r.innerHTML=('<li data-review_id="'+e.id+'"><p>'+e.name+"</p>\n<p>"+t+'</p>\n<p class="review-rating">Rating: '+e.rating+"</p>\n<p>"+e.comments+'</p>\n<button class="remove-review" title="Remove review">X</button><button class="edit-review">edit</button></li>').replace(/>\s+</,"><"),r.firstChild},this.fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:u.state.restaurant,t=document.getElementById("breadcrumb"),r=document.createElement("li");r.innerHTML=" "+e.name,t.appendChild(r)},this.getParameterByName=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"id",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.location.href;t||(t=window.location.href);var r=e.replace(/[\[\]]/g,"\\$&"),n=new RegExp("[?&]"+r+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},document.getElementById("review-form").addEventListener("submit",function(e){e.preventDefault();var t=document.getElementById("review"),r=document.getElementById("rating"),n=document.getElementById("name"),i=u.getParameterByName(),o=new FormData;o.append("name",n.value),o.append("rating",r.value),o.append("comments",t.value),o.append("restaurant_id",i);var s={name:n.value,rating:r.value,comments:t.value,createdAt:new Date,updatedAt:new Date,restaurant_id:i};u.state.indexedDB.reviews.put(s).catch(console.error),document.getElementById("reviews-list").appendChild(u.createReviewHTML(s)),a.default.addReviewByRestaurant(o,"../").catch(function(){if(navigator.serviceWorker){var e=window.reg;e.sync&&e.sync.getTags&&u.state.indexedDB.reviewRequests.put({reviewID:i}).then(e.sync.register("syncReview"))}}).subscribe()})}return o(e,[{key:"addRemoveReviewListener",value:function(e,t){var r=this;e.addEventListener("click",function(e){e.preventDefault(),a.default.removeReviewByID(t,"../../").retryWhen(function(){return r.ONLINE$}).subscribe()})}}]),e}();r.default=u},{"./DBHelper":67,"./Restaurant":68,"./toast":71,"rxjs/Observable":4}],70:[function(e,t,r){"use strict";var n=s(e("./Restaurant")),i=s(e("./Review")),o=s(e("./DBHelper"));function s(e){return e&&e.__esModule?e:{default:e}}var u=document.getElementById("neighborhoods-select"),a=document.getElementById("cuisines-select"),c=function(){return location.pathname.match(/([\w_.]+)/g)||["/"]},l=function(t){return t.addEventListener("statechange",function(){if("installed"===t.state)return e=t,void(confirm("Update is ready. Refresh now?")&&e.postMessage({action:"skipWaiting"}));var e})},f=function(r,e){switch(e){case"/":return self.initMap=function(){r.setState({map:new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1})}),r.fetchNeighborhoods(),r.fetchCuisines(),google.maps.event.addListenerOnce(r.state.map,"idle",function(){setTimeout(function(){var e=document.getElementById("maincontent"),t=document.getElementById("overlay");e.style.visibility="visible",t.style.display="none"},100)})};case"review":return self.initMap=function(){return r.fetchRestaurantFromURL(function(e,t){e?console.error(e):(r.setState({map:new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1})}),r.fillBreadcrumb(),o.default.mapMarkerForRestaurant(r.state.restaurant,r.state.map)),google.maps.event.addListenerOnce(r.state.map,"idle",function(){setTimeout(function(){var e=document.getElementById("maincontent"),t=document.getElementById("overlay");e.style.visibility="visible",t.style.display="none"},100)})})}}};switch(c()[0]){case"/":var h=new n.default;f(h,"/"),a.addEventListener("change",function(){h.updateRestaurants()}),u.addEventListener("change",function(){h.updateRestaurants()});break;case"review":f(new i.default,"review")}var p=document.getElementById("toggle-map"),d=document.getElementById("map"),b=document.getElementById("map-container");d.style.display="none",p.addEventListener("click",function(e){e.preventDefault(),"none"===d.style.display?(d.style.display="block",b.style.display="block"):(d.style.display="none",b.style.display="none")}),navigator.serviceWorker&&navigator.serviceWorker.register("./"+("review"===c()[0]?"../../":"")+"sw.js").then(function(e){if(window.reg=e,navigator.serviceWorker.controller)return e.installing?(console.log("Service worker installing"),l(e.installing)):e.waiting?console.log("Service worker installed"):e.active&&console.log("Service worker active at scope: "+e.scope),e.addEventListener("updatefound",function(){return l(e.installing)})}).catch(function(e){return console.error("ServiceWorker registration failed with error: "+e)})},{"./DBHelper":67,"./Restaurant":68,"./Review":69}],71:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.toast=function(e,t){var r=document.createElement("div"),n="toast"+String(Math.random()).split(".")[1];r.className="toast-message "+t,r.innerHTML='<div id="'+n+'" aria-label="You\'re offline" aria-live="assertive">'+e+"</div>",document.body.append(r);var i=document.getElementById(n);setTimeout(function(){i.parentElement.remove()},5e3)}},{}]},{},[70]);